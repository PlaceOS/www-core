(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{aCzL:function(t,e,n){"use strict";n.r(e);var i=n("ofXK"),o=n("3Pt+"),c=n("tyNb"),s=n("THE0"),a=n("OaWH"),r=n("C/ya"),d=n("D/9M"),l=n("g+Po"),h=n("fXoL"),u=n("0IaG"),m=n("BAfr"),b=n("m6yr"),p=n("47y3");const g=function(){return{class:"backoffice-publish"}},f=function(t,e){return{id:"applications",name:"Applications",count:t,icon:e}},_=function(){return{class:"backoffice-lock-open"}},v=function(t,e){return{id:"authentication",name:"Authentication",count:t,icon:e}},w=function(){return{class:"backoffice-users"}},y=function(t,e){return{id:"users",name:"Users",count:t,icon:e}},O=function(t,e,n){return[t,e,n]};let C=(()=>{class t extends r.a{constructor(t,e,n,i){super(t,e,n),this._service=t,this._route=e,this._router=n,this._dialog=i,this.service=this._service.Domains}loadValues(){let t={offset:0,limit:1,owner:this.item.id};this._service.Applications.query(t).then(t=>this.applications=this._service.Applications.last_total||t.length||0),t={offset:0,limit:1,authority_id:this.item.id},this._service.Users.query(t).then(t=>this.user_count=this._service.Users.last_total||t.length||0)}new(){this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new s.d(this._service.Domains,{}),service:this._service.Domains}}).componentInstance.event.subscribe(t=>{"done"===t.reason&&this._router.navigate(["/domains",t.metadata.item.id])})}edit(){this.item&&this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Domains}})}delete(){if(this.item){const t=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete domain",content:"<p>Are you sure you want delete this domain?</p><p>The domain will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(e=>{"done"===e.reason&&(t.componentInstance.loading="Deleting domain...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted domain "${this.item.name}".`),this._router.navigate(["/users"]),t.close(),this.unsub("delete_confirm")},e=>{t.componentInstance.loading=null,this._service.notifyError(`Error deleting domain. Error: ${e}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(c.a),h.Rb(c.c),h.Rb(u.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["app-domains"]],features:[h.Ab],decls:5,vars:22,consts:[[1,"container"],[1,"sidebar"],["heading","Domains",3,"module","close","event"],[3,"touchrelease"],["name","domain","route","domains",3,"item","tabs","event"]],template:function(t,e){1&t&&(h.Xb(0,"div",0),h.Xb(1,"div",1),h.Xb(2,"sidebar",2),h.fc("event",(function(t){return e.sidebarEvent(t)})),h.Wb(),h.Wb(),h.Xb(3,"main",3),h.fc("touchrelease",(function(){return e.show_sidebar=!1})),h.Xb(4,"item-display",4),h.fc("event",(function(t){return e.itemEvent(t)})),h.Wb(),h.Wb(),h.Wb()),2&t&&(h.Hb("show",e.show_sidebar),h.Db(2),h.pc("module",e.module)("close",e.show_sidebar),h.Db(2),h.pc("item",e.item)("tabs",h.tc(18,O,h.sc(7,f,e.applications||0,h.qc(6,g)),h.sc(11,v,e.auth_sources||0,h.qc(10,_)),h.sc(15,y,e.user_count||0,h.qc(14,w)))))},directives:[m.a,b.b,p.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),t})();var W=n("5f3J"),X=n("bTqV"),P=n("0njA");const x=function(){return{class:"backoffice-edit"}},M=function(){return{class:"backoffice-trash"}};function A(t,e){if(1&t){const t=h.Yb();h.Xb(0,"tr"),h.Xb(1,"td",7),h.Jc(2),h.Wb(),h.Xb(3,"td",8),h.Jc(4),h.Wb(),h.Xb(5,"td",9),h.Jc(6),h.Wb(),h.Xb(7,"td",10),h.Xb(8,"button",12),h.fc("tapped",(function(){h.zc(t);const n=e.$implicit;return h.jc(3).editApplication(n)})),h.Sb(9,"app-icon",13),h.Wb(),h.Xb(10,"button",12),h.fc("tapped",(function(){h.zc(t);const n=e.$implicit;return h.jc(3).deleteApplication(n)})),h.Sb(11,"app-icon",13),h.Wb(),h.Wb(),h.Wb()}if(2&t){const t=e.$implicit;h.Db(2),h.Kc(t.name),h.Db(2),h.Kc(t.redirect),h.Db(2),h.Kc(t.scope),h.Db(3),h.pc("icon",h.qc(5,x)),h.Db(2),h.pc("icon",h.qc(6,M))}}function D(t,e){if(1&t&&(h.Xb(0,"div",6),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",7),h.Jc(4,"Name"),h.Wb(),h.Xb(5,"td",8),h.Jc(6,"Redirect"),h.Wb(),h.Xb(7,"td",9),h.Jc(8,"Scope"),h.Wb(),h.Sb(9,"td",10),h.Wb(),h.Xb(10,"tbody"),h.Hc(11,A,12,7,"tr",11),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc(2);h.Db(11),h.pc("ngForOf",t.application_list)}}function I(t,e){1&t&&(h.Xb(0,"div",14),h.Xb(1,"div",15),h.Jc(2,"No applications found"),h.Wb(),h.Wb())}function k(t,e){if(1&t){const t=h.Yb();h.Xb(0,"div",1),h.Xb(1,"section",2),h.Xb(2,"button",3),h.fc("tapped",(function(){return h.zc(t),h.jc().newApplication()})),h.Jc(3,"Add new"),h.Wb(),h.Wb(),h.Xb(4,"section"),h.Hc(5,D,12,1,"div",4),h.Hc(6,I,3,0,"div",5),h.Wb(),h.Wb()}if(2&t){const t=h.jc();h.Db(5),h.pc("ngIf",t.application_list&&t.application_list.length>0),h.Db(1),h.pc("ngIf",!t.application_list||t.application_list.length<=0)}}let S=(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadApplications()}))}ngOnChanges(t){t.item&&this.loadApplications()}loadApplications(t=0){this.item&&this._service.Applications.query({owner:this.item.id,offset:t}).then(e=>{t||(this.application_list=[]);for(const t of e||[]){let e=!1;for(const n of this.application_list)if(n.id===t.id){e=!0;break}e||this.application_list.push(t)}},()=>null)}newApplication(){this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new s.b(this._service.Applications,{}),service:this._service.Applications}})}editApplication(t){this.item&&this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,service:this._service.Applications}})}deleteApplication(t){if(t){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete application",content:`<p>Are you sure you want delete the application ${t.name}?</p><p>Configuration will be <strong>immediately</strong> updated</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(n=>{"done"===n.reason&&(e.componentInstance.loading="Deleting application...",t.delete().then(()=>{this._service.notifySuccess(`Successfully deleted application "${t.name}".`),this.loadApplications(),e.close(),this.unsub("delete_confirm")},t=>{e.componentInstance.loading=null,this._service.notifyError(`Error deleting application. Error: ${t}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(u.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-applications"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"scope"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&h.Hc(0,k,7,2,"div",0),2&t&&h.pc("ngIf",e.item)},directives:[i.m,X.b,b.b,i.l,P.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.duo[_ngcontent-%COMP%]{width:6em}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .scope[_ngcontent-%COMP%]{width:8em;min-width:8em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})();var J=n("dQMc");const j=function(){return{class:"backoffice-edit"}},E=function(){return{class:"backoffice-trash"}};function H(t,e){if(1&t){const t=h.Yb();h.Xb(0,"tr"),h.Xb(1,"td",6),h.Jc(2),h.Wb(),h.Xb(3,"td",7),h.Jc(4),h.Wb(),h.Xb(5,"td",8),h.Xb(6,"button",10),h.fc("tapped",(function(){h.zc(t);const n=e.$implicit;return h.jc(2).editAuthSource(n)})),h.Sb(7,"app-icon",11),h.Wb(),h.Xb(8,"button",10),h.fc("tapped",(function(){h.zc(t);const n=e.$implicit;return h.jc(2).deleteAuthSource(n)})),h.Sb(9,"app-icon",11),h.Wb(),h.Wb(),h.Wb()}if(2&t){const t=e.$implicit,n=h.jc(2);h.Db(2),h.Kc(t.name),h.Db(2),h.Kc(n.source_types[t.id]),h.Db(3),h.pc("icon",h.qc(4,j)),h.Db(2),h.pc("icon",h.qc(5,E))}}function q(t,e){if(1&t&&(h.Xb(0,"div",5),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",6),h.Jc(4,"Name"),h.Wb(),h.Xb(5,"td",7),h.Jc(6,"Type"),h.Wb(),h.Sb(7,"td",8),h.Wb(),h.Xb(8,"tbody"),h.Hc(9,H,10,6,"tr",9),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc();h.Db(9),h.pc("ngForOf",t.auth_sources)}}function F(t,e){1&t&&(h.Xb(0,"div",12),h.Xb(1,"div",13),h.Jc(2,"No authentication sources found"),h.Wb(),h.Wb())}function $(t,e){if(1&t&&(h.Xb(0,"tr"),h.Xb(1,"td",4),h.Jc(2),h.Wb(),h.Xb(3,"td",5),h.Jc(4),h.Wb(),h.Xb(5,"td",6),h.Jc(6),h.Wb(),h.Wb()),2&t){const t=e.$implicit;h.Db(2),h.Kc(t.name),h.Db(2),h.Kc(t.email),h.Db(2),h.Kc(t.role)}}function K(t,e){if(1&t&&(h.Xb(0,"div",3),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",4),h.Jc(4,"Name"),h.Wb(),h.Xb(5,"td",5),h.Jc(6,"Email"),h.Wb(),h.Xb(7,"td",6),h.Jc(8,"Role"),h.Wb(),h.Wb(),h.Xb(9,"tbody"),h.Hc(10,$,7,3,"tr",7),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc();h.Db(10),h.pc("ngForOf",t.model.list)}}function z(t,e){1&t&&(h.Xb(0,"div",8),h.Xb(1,"div",9),h.Jc(2,"No users found"),h.Wb(),h.Wb())}const R=[{path:"",component:C,children:[]},{path:":id",component:C,children:[{path:"applications",component:S},{path:"authentication",component:(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.auth_sources=[],this.source_types={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadAuthSources()}))}ngOnChanges(t){t.item&&this.loadAuthSources()}loadAuthSources(t=0){this.item&&Promise.all([this._service.OAuthSources.query({authority_id:this.item.id,offset:t}),this._service.SAMLAuthSources.query({authority_id:this.item.id,offset:t}),this._service.LDAPAuthSources.query({authority_id:this.item.id,offset:t})]).then(e=>{t||(this.auth_sources=[]);for(const t of e)t.forEach(t=>this.addAuthSourceToList(t))},()=>null)}newAuthSource(){this._dialog.open(J.a,{width:"auto",height:"auto",data:{domain:this.item}}).afterClosed().subscribe(()=>this.loadAuthSources())}editAuthSource(t){this._dialog.open(J.a,{width:"auto",height:"auto",data:{domain:this.item,auth_source:t}}).afterClosed().subscribe(()=>this.loadAuthSources())}deleteAuthSource(t){if(t){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete auth source",content:"<p>Are you sure you want delete this auth source?</p><p>Deleting this will device <strong>immediately</strong> remove it from any system associated with it</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(n=>{"done"===n.reason&&(e.componentInstance.loading="Deleting auth source...",t.delete().then(()=>{this._service.notifySuccess("Successfully deleted auth source."),e.close(),this.unsub("delete_confirm"),this.loadAuthSources()},t=>{this._service.notifyError(`Error deleting auth source. Error ${t.message||t}`),e.componentInstance.loading=null}))}))}}addAuthSourceToList(t){this.source_types[t.id]=t instanceof s.l?"saml":t instanceof s.g?"ldap":"oauth";const e=this.auth_sources.findIndex(e=>e.id===t.id);e<0?this.auth_sources.push(t):this.auth_sources.splice(e,1,t)}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(u.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-authentication"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:8,vars:2,consts:[[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf","ngIfElse"],["no_auth_sources",""],[1,"list"],[1,"name"],[1,"flex"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){if(1&t&&(h.Xb(0,"div",0),h.Xb(1,"section",1),h.Xb(2,"button",2),h.fc("tapped",(function(){return e.newAuthSource()})),h.Jc(3,"Add new"),h.Wb(),h.Wb(),h.Xb(4,"section"),h.Hc(5,q,10,1,"div",3),h.Wb(),h.Wb(),h.Hc(6,F,3,0,"ng-template",null,4,h.Ic)),2&t){const t=h.wc(7);h.Db(5),h.pc("ngIf",e.auth_sources&&e.auth_sources.length>0)("ngIfElse",t)}},directives:[X.b,b.b,i.m,i.l,P.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}.duo[_ngcontent-%COMP%]{width:6em;text-align:right}"]}),t})()},{path:"users",component:(()=>{class t extends W.a{constructor(t){super(),this._service=t,this.model={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadUsers()})),this.loadUsers()}ngOnChanges(t){t.item&&this.loadUsers()}loadUsers(t=0){this.item&&this._service.Users.query({authority_id:this.item.id,offset:t}).then(e=>{t||(this.model.list=[]);for(const t of e||[]){let e=!1;for(const n of this.model.list)if(n.id===t.id){e=!0;break}e||this.model.list.push(t)}},()=>null)}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-users"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:4,vars:2,consts:[[1,"container"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"role"],[4,"ngFor","ngForOf"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&(h.Xb(0,"div",0),h.Xb(1,"section"),h.Hc(2,K,11,1,"div",1),h.Hc(3,z,3,0,"div",2),h.Wb(),h.Wb()),2&t&&(h.Db(2),h.pc("ngIf",e.model.list&&e.model.list.length>0),h.Db(1),h.pc("ngIf",!e.model.list||e.model.list.length<=0))},directives:[i.m,i.l],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:12em;min-width:12em}.table-row[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})()},{path:"**",redirectTo:"applications"}]},{path:"**",redirectTo:""}];var L=n("PCNd");n.d(e,"AppDomainsModule",(function(){return N}));let N=(()=>{class t{}return t.\u0275mod=h.Pb({type:t}),t.\u0275inj=h.Ob({factory:function(e){return new(e||t)},imports:[[i.c,o.g,c.g.forChild(R),L.a]]}),t})()}}]);