(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{Gwc7:function(e,t,n){"use strict";n.r(t);var c=n("TYT/"),i=n("Valr"),o=n("QJY3"),r=n("DUip"),s=n("pS6y"),a=n("mrSG"),d=n("UN3I"),l=n("OaWH"),u=n("C/ya"),m=n("g+Po"),f=n("D/9M"),h=n("QrbZ"),g=n("BAfr"),v=n("ZwpQ"),p=n("47y3"),b=n("5f3J"),_=n("2mMm"),y=n("rUqb"),w=[1,"container"],M=[1,"flex"],C=[1,"class"],O=[1,"class","mono"],P=["mat-button","",3,"tapped"],I=[3,"ngModel","readonly"],k=function(e){function t(t,n){var c=e.call(this)||this;return c._dialog=t,c._service=n,c}return a.d(t,e),Object.defineProperty(t.prototype,"settings",{get:function(){return this.item.settings.settings_string},enumerable:!0,configurable:!0}),t.prototype.reloadDriver=function(){var e=this;if(this.item){var t=this._dialog.open(m.b,a.a({},m.a,{data:{title:"Reload Driver",content:"<p>Are you sure you want reload this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(function(n){"done"===n.reason&&(t.componentInstance.loading="Reloading driver...",e.item.reload().then(function(){e._service.notifySuccess('Successfully reloaded driver "'+e.item.name+'".'),t.close(),e.unsub("delete_confirm")},function(n){t.componentInstance.loading=null,e._service.notifyError("Error reloading driver. Error: "+n)}))}))}},t.ngComponentDef=c.Rb({type:t,selectors:[["driver-about"]],factory:function(e){return new(e||t)(c.Xb(h.b),c.Xb(l.a))},inputs:{item:"item"},features:[c.Fb],consts:21,vars:4,template:function(e,t){1&e&&(c.ec(0,"div",w),c.ec(1,"section"),c.ec(2,"table"),c.ec(3,"thead"),c.ec(4,"td",M),c.Tc(5,"Module Name"),c.cc(),c.ec(6,"td",C),c.Tc(7,"Class"),c.cc(),c.cc(),c.ec(8,"tbody"),c.ec(9,"tr"),c.ec(10,"td",M),c.Tc(11),c.cc(),c.ec(12,"td",O),c.Tc(13),c.cc(),c.cc(),c.cc(),c.cc(),c.cc(),c.ec(14,"section"),c.ec(15,"button",P),c.kc("tapped",function(e){return t.reloadDriver()}),c.Tc(16,"Reload Modules"),c.cc(),c.cc(),c.ec(17,"header"),c.Tc(18,"Settings"),c.cc(),c.ec(19,"section"),c.Yb(20,"settings-form-field",I),c.cc(),c.cc()),2&e&&(c.Ic(11),c.Uc(null==t.item?null:t.item.module_name),c.Ic(13),c.Uc(null==t.item?null:t.item.class_name),c.Ic(20),c.vc("ngModel",t.settings)("readonly",!0))},directives:[_.b,v.b,y.a,o.k,o.n],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}.table-row[_ngcontent-%COMP%]   .class[_ngcontent-%COMP%]{width:12em;min-width:12em}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t}(b.a),D=n("K9Ia"),x=n("F/XL"),T=n("Gi3i"),E=n("ad02"),S=n("15JJ"),R=n("9Z1F"),Y=n("67Y/"),j=n("FgbW"),F=n("0njA"),X=n("M+/Y"),A=[1,"container"],U=[1,"settings"],$=[1,"select"],L=["appearance","outline"],J=["matPrefix","",1,"prefix"],N=[3,"icon"],q=["matInput","","name","search-filter","placeholder","Filter Devices",3,"ngModel","ngModelChange"],Q=[1,"list"],G=[4,"ngIf"],V=["class","info-block",4,"ngIf"],W=[1,"small"],z=[1,"flex"],B=[1,"system"],H=[4,"ngFor","ngForOf"],Z=[1,"state"],K=["binding","","bind","connected",3,"model","sys","mod","modelChange"],ee=[3,"routerLink"],te=[1,"id"],ne=["mat-icon-button","",3,"tapped"],ce=[1,"backoffice-trash"],ie=function(e){return["/modules",e]},oe=function(e){return["/systems",e]};function re(e,t){if(1&e){var n=c.fc();c.ec(0,"tr"),c.ec(1,"td",W),c.ec(2,"div",Z),c.Pc(),c.cc(),c.ec(3,"i",K),c.kc("modelChange",function(e){return c.Ec(n),t.$implicit.enabled=e}),c.cc(),c.cc(),c.ec(4,"td",z),c.ec(5,"a",ee),c.Tc(6),c.cc(),c.cc(),c.ec(7,"td",B),c.ec(8,"a",ee),c.Tc(9),c.ec(10,"span",te),c.Tc(11),c.cc(),c.Tc(12,") "),c.cc(),c.cc(),c.ec(13,"td",W),c.ec(14,"button",ne),c.kc("tapped",function(e){c.Ec(n);var i=t.$implicit;return c.pc(2).removeDevice(i)}),c.Yb(15,"i",ce),c.cc(),c.cc(),c.cc()}if(2&e){var i=t.$implicit;c.Ic(2),c.Mb("active",i.enabled),c.Qc(),c.Ic(3),c.vc("model",i.enabled)("sys",i.system.id)("mod",i.module_name),c.Ic(5),c.vc("routerLink",c.wc(9,ie,i.id)),c.Ic(6),c.Uc(i.name),c.Ic(8),c.vc("routerLink",c.wc(11,oe,i.system.id)),c.Ic(9),c.Vc(" ",null==i.system?null:i.system.name," ("),c.Ic(11),c.Uc(null==i.system?null:i.system.id)}}function se(e,t){if(1&e&&(c.ec(0,"table"),c.ec(1,"thead"),c.Yb(2,"td",W),c.ec(3,"td",z),c.Tc(4,"Name"),c.cc(),c.ec(5,"td",B),c.Tc(6,"System"),c.cc(),c.Yb(7,"td",W),c.cc(),c.ec(8,"tbody"),c.Rc(9,re,16,13,"tr",H),c.cc(),c.cc()),2&e){var n=c.pc();c.Ic(9),c.vc("ngForOf",n.device_list)}}var ae=[1,"info-block"],de=[1,"text"];function le(e,t){1&e&&(c.ec(0,"div",ae),c.ec(1,"div",de),c.Tc(2,"No devices with driver"),c.cc(),c.cc())}var ue={class:"backoffice-magnifying-glass"},me=function(e){function t(t,n){var c=e.call(this)||this;return c._service=t,c._dialog=n,c.device_list=[],c.search$=new D.a,c}return a.d(t,e),t.prototype.ngOnInit=function(){var e=this;this.search_results$=this.search$.pipe(Object(T.a)(400),Object(E.a)(),Object(S.a)(function(t){return e.loading=!0,e._service.Modules.query({q:t,dependency_id:e.item.id,offset:0,limit:500})}),Object(R.a)(function(e){return console.error(e),Object(x.a)([])}),Object(Y.a)(function(t){e.loading=!1;var n=e.search_str.toLowerCase();return t.filter(function(e){return e.name.toLowerCase().indexOf(n)>=0||(e.email||"").toLowerCase().indexOf(n)>=0})})),this.subscription("search_results",this.search_results$.subscribe(function(t){return e.device_list=t}))},t.prototype.ngOnChanges=function(e){e.item&&this.loadDevices()},t.prototype.loadDevices=function(e){var t=this;void 0===e&&(e=0),this._service.Modules.query({dependency_id:this.item.id,offset:e,limit:500}).then(function(e){return t.device_list=e},function(){return null})},t.prototype.removeDevice=function(e){var t=this;if(e){var n=this._dialog.open(m.b,a.a({},m.a,{data:{title:"Delete device",content:"<p>Are you sure you want delete this device?</p><p>Deleting this will device <strong>immediately</strong> remove it from any system associated with it</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe(function(c){"done"===c.reason&&(n.componentInstance.loading="Deleting device...",e.delete().then(function(){t._service.notifySuccess('Successfully deleted device "'+e.name+'".'),t.loadDevices(),n.close(),t.unsub("delete_confirm")},function(e){n.componentInstance.loading=null,t._service.notifyError("Error deleting device. Error: "+e)}))}))}},t.ngComponentDef=c.Rb({type:t,selectors:[["driver-devices"]],factory:function(e){return new(e||t)(c.Xb(l.a),c.Xb(h.b))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:10,vars:4,template:function(e,t){1&e&&(c.ec(0,"div",A),c.ec(1,"div",U),c.ec(2,"section",$),c.ec(3,"mat-form-field",L),c.ec(4,"div",J),c.Yb(5,"app-icon",N),c.cc(),c.ec(6,"input",q),c.kc("ngModelChange",function(e){return t.search_str=e}),c.kc("ngModelChange",function(e){return t.search$.next(e)}),c.cc(),c.cc(),c.cc(),c.ec(7,"section",Q),c.Rc(8,se,10,1,"table",G),c.Rc(9,le,3,0,"div",V),c.cc(),c.cc(),c.cc()),2&e&&(c.Ic(5),c.vc("icon",ue),c.Ic(6),c.vc("ngModel",t.search_str),c.Ic(8),c.vc("ngIf",t.device_list&&t.device_list.length>0),c.Ic(9),c.vc("ngIf",!t.device_list||t.device_list.length<=0))},directives:[j.b,j.e,F.a,X.a,o.b,o.k,o.n,i.n,i.m,s.a,r.f,_.b,v.b],styles:[".container[_ngcontent-%COMP%]{padding:1em}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.list[_ngcontent-%COMP%]{margin-top:.5em}.table-row[_ngcontent-%COMP%]   .system[_ngcontent-%COMP%]{width:12em;min-width:12em}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin 250ms,height 250ms,width 250ms,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}"]}),t}(b.a),fe=[1,"container"],he=[1,"sidebar"],ge=["heading","Drivers",3,"module","close","searchChange","event"],ve=[3,"touchrelease"],pe=["name","driver",3,"item","active","tabs","event"],be=["about",""],_e=["devices",""],ye=[3,"item"];function we(e,t){if(1&e&&c.Yb(0,"driver-about",ye),2&e){var n=c.pc();c.vc("item",n.item)}}function Me(e,t){if(1&e&&c.Yb(0,"driver-devices",ye),2&e){var n=c.pc();c.vc("item",n.item)}}var Ce={class:"backoffice-info-with-circle"},Oe=function(e){return{id:"about",name:"About",template:e,icon:Ce}},Pe={class:"backoffice-tablet"},Ie=function(e,t){return{id:"devices",name:"Devices",template:e,count:t,icon:Pe}},ke=function(e,t){return[e,t]},De=function(e){function t(t,n,c,i){var o=e.call(this,t,n,c)||this;return o._service=t,o._route=n,o._router=c,o._dialog=i,o.service=o._service.Drivers,o}return a.d(t,e),t.prototype.loadValues=function(){var e=this;this._service.Modules.query({offset:0,limit:1,dependency_id:this.item.id}).then(function(){e.device_count=e._service.Modules.last_total||0})},t.prototype.new=function(){this._dialog.open(f.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new d.f(this._service.Drivers,{}),service:this._service.Drivers}})},t.prototype.edit=function(){this.item&&this._dialog.open(f.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Drivers}})},t.prototype.delete=function(){var e=this;if(this.item){var t=this._dialog.open(m.b,a.a({},m.a,{data:{title:"Delete driver",content:"<p>Are you sure you want delete this driver?</p><p>All devices that rely on this driver will be <strong>immediately</strong> removed.</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(function(n){"done"===n.reason&&(t.componentInstance.loading="Deleting driver...",e.item.delete().then(function(){e._service.notifySuccess('Successfully deleted driver "'+e.item.name+'".'),e._router.navigate(["/drivers"]),t.close(),e.unsub("delete_confirm")},function(n){t.componentInstance.loading=null,e._service.notifyError("Error deleting driver. Error: "+n)}))}))}},t.ngComponentDef=c.Rb({type:t,selectors:[["app-drivers"]],factory:function(e){return new(e||t)(c.Xb(l.a),c.Xb(r.a),c.Xb(r.c),c.Xb(h.b))},features:[c.Fb],consts:9,vars:14,template:function(e,t){if(1&e&&(c.ec(0,"div",fe),c.Pc(),c.ec(1,"div",he),c.ec(2,"sidebar",ge),c.kc("searchChange",function(e){return t.search(e)}),c.kc("event",function(e){return t.sidebarEvent(e)}),c.cc(),c.cc(),c.ec(3,"main",ve),c.kc("touchrelease",function(e){return t.show_sidebar=!1}),c.ec(4,"item-display",pe),c.kc("event",function(e){return t.itemEvent(e)}),c.Rc(5,we,1,1,"ng-template",null,be,c.Sc),c.Rc(7,Me,1,1,"ng-template",null,_e,c.Sc),c.cc(),c.cc(),c.cc()),2&e){var n=c.Bc(6),i=c.Bc(8);c.Mb("show",t.show_sidebar),c.Qc(),c.Ic(2),c.vc("module",t.module)("close",t.show_sidebar),c.Ic(4),c.vc("item",t.item)("active",t.tab)("tabs",c.xc(11,ke,c.wc(6,Oe,n),c.xc(8,Ie,i,t.device_count)))}},directives:[g.a,v.b,p.a,k,me],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}"]}),t}(u.a),xe=[{path:"",component:De,children:[]},{path:":id",component:De,children:[]},{path:"**",redirectTo:""}],Te=n("PCNd");n.d(t,"AppDriversModule",function(){return Ee});var Ee=function(){function e(){}return e.ngModuleDef=c.Vb({type:e}),e.ngInjectorDef=c.Ub({factory:function(t){return new(t||e)},imports:[[i.c,o.g,s.b,r.g.forChild(xe),Te.a]]}),e}();r.g.forChild(xe)}}]);