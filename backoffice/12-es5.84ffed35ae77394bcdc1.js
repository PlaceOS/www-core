(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{FWSw:function(e,t,n){"use strict";n.r(t);var c=n("TYT/"),i=n("Valr"),o=n("QJY3"),r=n("DUip"),s=n("pS6y"),a=n("mrSG"),g=n("UN3I"),l=n("OaWH"),d=n("C/ya"),m=n("D/9M"),u=n("g+Po"),f=n("QrbZ"),h=n("BAfr"),p=n("ZwpQ"),v=n("47y3"),b=n("5f3J"),_=n("rUqb"),y=n("FgbW"),C=n("XmVM"),O=n("S8bm"),M=n("Mj3r"),w=n("p6iS"),I=[1,"container"],P=[4,"ngIf"],T=["class","tags",4,"ngIf"],k=[3,"ngModel","readonly"];function x(e,t){1&e&&(c.ec(0,"header"),c.Tc(1,"Execute Command"),c.cc())}var S=["appearance","outline"],z=["placeholder","Select system",3,"ngModel","ngModelChange"],F=[3,"value",4,"ngFor","ngForOf"],R=[3,"system",4,"ngIf"],E=[3,"value"];function Y(e,t){if(1&e&&(c.ec(0,"mat-option",E),c.Tc(1),c.cc()),2&e){var n=t.$implicit;c.vc("value",n),c.Ic(1),c.Vc(" ",n.name," ")}}var D=[3,"system"];function j(e,t){if(1&e&&c.Yb(0,"system-exec-field",D),2&e){var n=c.pc(2);c.vc("system",n.active_system)}}function $(e,t){if(1&e){var n=c.fc();c.ec(0,"section"),c.ec(1,"mat-form-field",S),c.ec(2,"mat-select",z),c.kc("ngModelChange",function(e){return c.Ec(n),c.pc().active_system=e}),c.Rc(3,Y,2,2,"mat-option",F),c.cc(),c.cc(),c.Rc(4,j,1,1,"system-exec-field",R),c.cc()}if(2&e){var i=c.pc();c.Ic(2),c.vc("ngModel",i.active_system),c.Ic(3),c.vc("ngForOf",i.system_list),c.Ic(4),c.vc("ngIf",i.active_system&&i.active_system.id)}}var A=[1,"tags"],U=["for","tags"],X=[1,"value"],L=["name","tags"],Z=[4,"ngFor","ngForOf"];function q(e,t){if(1&e&&(c.ec(0,"mat-chip"),c.Tc(1),c.cc()),2&e){var n=t.$implicit;c.Ic(1),c.Uc(n)}}function N(e,t){if(1&e&&(c.ec(0,"section",A),c.ec(1,"label",U),c.Tc(2,"Tags:"),c.cc(),c.ec(3,"div",X),c.ec(4,"mat-chip-list",L),c.Rc(5,q,2,1,"mat-chip",Z),c.cc(),c.cc(),c.cc()),2&e){var n=c.pc();c.Ic(5),c.vc("ngForOf",n.tag_list)}}var B=function(e){function t(t){var n=e.call(this)||this;return n._service=t,n}return a.d(t,e),t.prototype.ngOnChanges=function(e){e.item&&this.item&&this.loadSystems()},Object.defineProperty(t.prototype,"settings",{get:function(){return this.item.settings.settings_string},enumerable:!0,configurable:!0}),t.prototype.loadSystems=function(e){var t=this;void 0===e&&(e=0),this._service.Systems.query({offset:e,zone_id:this.item.id,limit:500}).then(function(e){t.system_list=e})},Object.defineProperty(t.prototype,"tag_list",{get:function(){return this.item&&this.item.tags?this.item.tags.split(","):[]},enumerable:!0,configurable:!0}),t.ngComponentDef=c.Rb({type:t,selectors:[["zone-about"]],factory:function(e){return new(e||t)(c.Xb(l.a))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:8,vars:5,template:function(e,t){1&e&&(c.ec(0,"div",I),c.Rc(1,x,2,0,"header",P),c.Rc(2,$,5,3,"section",P),c.Rc(3,N,6,1,"section",T),c.ec(4,"header"),c.Tc(5,"Settings"),c.cc(),c.ec(6,"section"),c.Yb(7,"settings-form-field",k),c.cc(),c.cc()),2&e&&(c.Ic(1),c.vc("ngIf",t.system_list&&t.system_list.length),c.Ic(2),c.vc("ngIf",t.system_list&&t.system_list.length),c.Ic(3),c.vc("ngIf",t.item&&t.tag_list),c.Ic(7),c.vc("ngModel",t.settings)("readonly",!0))},directives:[i.n,_.a,o.k,o.n,y.b,C.a,i.m,O.h,M.a,w.c,w.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.tags[_ngcontent-%COMP%]{display:flex}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500;padding:.75em .5em}"]}),t}(b.a),G=n("K9Ia"),J=n("F/XL"),V=n("Gi3i"),Q=n("ad02"),W=n("15JJ"),H=n("9Z1F"),K=n("67Y/"),ee=n("0njA"),te=n("M+/Y"),ne=[1,"container"],ce=[1,"btn"],ie=["appearance","outline"],oe=["matPrefix","",1,"prefix"],re=[3,"icon"],se=["matInput","","name","search-filter","placeholder","Filter Systems",3,"ngModel","ngModelChange"],ae=["class","list",4,"ngIf","ngIfElse"],ge=["empty_state",""],le=[1,"list"],de=[1,"flex"],me=[1,"devices"],ue=[1,"created"],fe=[4,"ngFor","ngForOf"],he=["routerLinkActive","router-link-active",3,"routerLink"],pe=[1,"id"],ve=[1,"devices","align-right"],be=function(e){return["/systems",e]};function _e(e,t){if(1&e&&(c.ec(0,"tr"),c.ec(1,"td",de),c.ec(2,"a",he),c.Tc(3),c.ec(4,"span",pe),c.Tc(5),c.cc(),c.Tc(6,") "),c.cc(),c.cc(),c.ec(7,"td",ve),c.Tc(8),c.cc(),c.ec(9,"td",ue),c.Tc(10),c.cc(),c.cc()),2&e){var n=t.$implicit;c.Ic(2),c.vc("routerLink",c.wc(5,be,n.id)),c.Ic(3),c.Vc(" ",n.name," ("),c.Ic(5),c.Uc(n.id),c.Ic(8),c.Uc(n.installed_ui_devices),c.Ic(10),c.Uc(null==n.display?null:n.display.created)}}function ye(e,t){if(1&e&&(c.ec(0,"div",le),c.ec(1,"table"),c.ec(2,"thead"),c.ec(3,"td",de),c.Tc(4,"Name"),c.cc(),c.ec(5,"td",me),c.Tc(6,"No. Devices"),c.cc(),c.ec(7,"td",ue),c.Tc(8,"Created"),c.cc(),c.cc(),c.ec(9,"tbody"),c.Rc(10,_e,11,7,"tr",fe),c.cc(),c.cc(),c.cc()),2&e){var n=c.pc();c.Ic(10),c.vc("ngForOf",n.system_list)}}var Ce=[1,"info-block"],Oe=[1,"text"];function Me(e,t){1&e&&(c.ec(0,"div",Ce),c.ec(1,"div",Oe),c.Tc(2,"No systems found"),c.cc(),c.cc())}var we={class:"backoffice-magnifying-glass"},Ie=function(e){function t(t){var n=e.call(this)||this;return n._service=t,n.system_list=[],n.search$=new G.a,n}return a.d(t,e),t.prototype.ngOnInit=function(){var e=this;this.search_results$=this.search$.pipe(Object(V.a)(400),Object(Q.a)(),Object(W.a)(function(t){return e.loading=!0,e._service.Systems.query({q:t,module_id:e.item.id,offset:0})}),Object(H.a)(function(e){return console.error(e),Object(J.a)([])}),Object(K.a)(function(t){e.loading=!1;var n=e.search_str.toLowerCase();return t.filter(function(e){return e.name.toLowerCase().indexOf(n)>=0||(e.email||"").toLowerCase().indexOf(n)>=0})})),this.search$.next(""),this.subscription("search_results",this.search_results$.subscribe(function(t){return e.system_list=t}))},t.prototype.ngOnChanges=function(e){e.item&&this.loadSystems()},t.prototype.loadSystems=function(e){var t=this;void 0===e&&(e=0),this._service.Systems.query({offset:e,zone_id:this.item.id,limit:500}).then(function(e){return t.system_list=e})},t.ngComponentDef=c.Rb({type:t,selectors:[["zone-systems"]],factory:function(e){return new(e||t)(c.Xb(l.a))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:9,vars:4,template:function(e,t){if(1&e&&(c.ec(0,"div",ne),c.ec(1,"div",ce),c.ec(2,"mat-form-field",ie),c.ec(3,"div",oe),c.Yb(4,"app-icon",re),c.cc(),c.ec(5,"input",se),c.kc("ngModelChange",function(e){return t.search_str=e}),c.kc("ngModelChange",function(e){return t.search$.next(e)}),c.cc(),c.cc(),c.cc(),c.Rc(6,ye,11,1,"div",ae),c.cc(),c.Rc(7,Me,3,0,"ng-template",null,ge,c.Sc)),2&e){var n=c.Bc(8);c.Ic(4),c.vc("icon",we),c.Ic(5),c.vc("ngModel",t.search_str),c.Ic(6),c.vc("ngIf",t.system_list&&t.system_list.length>0)("ngIfElse",n)}},directives:[y.b,y.e,ee.a,te.a,o.b,o.k,o.n,i.n,i.m,r.f,r.e],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.table-row[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .devices[_ngcontent-%COMP%]{width:10em}"]}),t}(b.a),Pe=n("YxBP"),Te=n("uxQG"),ke=n("2mMm"),xe=[1,"container"],Se=[1,"settings"],ze=[1,"select"],Fe=[1,"dropdown"],Re=["mat-button","",3,"tapped"],Ee=["appearance","outline"],Ye=["matPrefix","",1,"prefix"],De=[3,"icon"],je=["matInput","","name","search-filter","placeholder","Filter Triggers",3,"ngModel","ngModelChange"],$e=[1,"list"],Ae=[4,"ngIf"],Ue=["class","info-block",4,"ngIf"],Xe=[1,"name"],Le=[1,"flex"],Ze=[1,"small"],qe=[4,"ngFor","ngForOf"],Ne=[3,"routerLink"],Be=[1,"flex","description"],Ge=["mat-icon-button","",3,"tapped"],Je=function(e){return["/triggers",e]},Ve={class:"backoffice-trash"};function Qe(e,t){if(1&e){var n=c.fc();c.ec(0,"tr"),c.ec(1,"td",Xe),c.ec(2,"a",Ne),c.Tc(3),c.cc(),c.cc(),c.ec(4,"td",Be),c.Tc(5),c.cc(),c.ec(6,"td",Ze),c.ec(7,"button",Ge),c.kc("tapped",function(e){c.Ec(n);var i=t.$implicit;return c.pc(2).deleteTrigger(i)}),c.Yb(8,"app-icon",De),c.cc(),c.cc(),c.cc()}if(2&e){var i=t.$implicit;c.Ic(2),c.vc("routerLink",c.wc(4,Je,i.id)),c.Ic(3),c.Uc(i.name),c.Ic(5),c.Uc(i.description),c.Ic(8),c.vc("icon",Ve)}}function We(e,t){if(1&e&&(c.ec(0,"table"),c.ec(1,"thead"),c.ec(2,"td",Xe),c.Tc(3,"Name"),c.cc(),c.ec(4,"td",Le),c.Tc(5,"Description"),c.cc(),c.Yb(6,"td",Ze),c.cc(),c.ec(7,"tbody"),c.Rc(8,Qe,9,6,"tr",qe),c.cc(),c.cc()),2&e){var n=c.pc();c.Ic(8),c.vc("ngForOf",n.model.triggers)}}var He=[1,"info-block"],Ke=[1,"text"];function et(e,t){1&e&&(c.ec(0,"div",He),c.ec(1,"div",Ke),c.Tc(2,"No triggers for zone"),c.cc(),c.cc())}var tt={class:"backoffice-magnifying-glass"},nt=function(e){function t(t,n){var c=e.call(this)||this;return c._service=t,c._dialog=n,c.model={},c}return a.d(t,e),t.prototype.ngOnChanges=function(e){e.item&&this.load()},t.prototype.load=function(e){var t=this;void 0===e&&(e=0),this._service.SystemTriggers.query({zone_id:this.item.id,offset:e}).then(function(e){t.model.triggers=e},function(){return null})},t.prototype.deleteTrigger=function(e){var t=this;if(this.item&&e){var n=this.item.triggers.indexOf(e.id);if(n<0)return;var c=this._dialog.open(u.b,a.a({},u.a,{data:{title:"Remove trigger",content:'<p>Are you sure you want remove trigger "'+e.name+'"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>',icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",c.componentInstance.event.subscribe(function(e){if("done"===e.reason){c.componentInstance.loading="Removing trigger...";var i=t.item.triggers.slice();i.splice(n,1),t.item.storePendingChange("triggers",i),t.item.save().then(function(){return t._service.notifySuccess("Sucessfully removed trigger")},function(e){return t._service.notifyError("Error removing trigger. Error: "+(e.message||e))}),c.close(),t.unsub("delete_confirm")}}))}},t.prototype.selectTriggerToAdd=function(){var e=this,t=this._dialog.open(Te.a,{height:"auto",width:"auto",data:{service_name:"Triggers"}});this.subscription("dialog_events",t.componentInstance.event.subscribe(function(n){var c=t.componentInstance.item;"action"===n.reason&&c&&(e.addTrigger(c),t.close())})),t.afterClosed().subscribe(function(){return e.unsub("dialog_events")})},t.prototype.addTrigger=function(e){var t=this,n=Object(Pe.e)(this.item.triggers.concat(e.id));console.log("Triggers:",n,this.item.triggers),this.item.storePendingChange("triggers",n),this.item.save().then(function(){return t._service.notifySuccess("Sucessfully added trigger")},function(e){return t._service.notifyError("Error adding trigger. Error: "+(e.message||e))})},t.ngComponentDef=c.Rb({type:t,selectors:[["zone-triggers"]],factory:function(e){return new(e||t)(c.Xb(l.a),c.Xb(f.b))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:13,vars:4,template:function(e,t){1&e&&(c.ec(0,"div",xe),c.ec(1,"div",Se),c.ec(2,"section",ze),c.ec(3,"div",Fe),c.ec(4,"button",Re),c.kc("tapped",function(e){return t.selectTriggerToAdd()}),c.Tc(5,"Add trigger"),c.cc(),c.cc(),c.ec(6,"mat-form-field",Ee),c.ec(7,"div",Ye),c.Yb(8,"app-icon",De),c.cc(),c.ec(9,"input",je),c.kc("ngModelChange",function(e){return t.search_str=e}),c.cc(),c.cc(),c.cc(),c.ec(10,"section",$e),c.Rc(11,We,9,1,"table",Ae),c.Rc(12,et,3,0,"div",Ue),c.cc(),c.cc(),c.cc()),2&e&&(c.Ic(8),c.vc("icon",tt),c.Ic(9),c.vc("ngModel",t.search_str),c.Ic(11),c.vc("ngIf",t.model.triggers&&t.model.triggers.length>0),c.Ic(12),c.vc("ngIf",!t.model.triggers||t.model.triggers.length<=0))},directives:[ke.b,p.b,y.b,y.e,ee.a,te.a,o.b,o.k,o.n,i.n,i.m,r.f],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}.name[_ngcontent-%COMP%]{min-width:10em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin 250ms,height 250ms,width 250ms,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.description[_ngcontent-%COMP%]{font-size:.8em;padding:.5em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:50%}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.select[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}"]}),t}(b.a),ct=[1,"container"],it=[1,"sidebar"],ot=["heading","Zones",3,"module","close","searchChange","event"],rt=[3,"touchrelease"],st=["name","zone",3,"item","active","tabs","event"],at=["about",""],gt=["systems",""],lt=["triggers",""],dt=[3,"item"];function mt(e,t){if(1&e&&c.Yb(0,"zone-about",dt),2&e){var n=c.pc();c.vc("item",n.item)}}function ut(e,t){if(1&e&&c.Yb(0,"zone-systems",dt),2&e){var n=c.pc();c.vc("item",n.item)}}function ft(e,t){if(1&e&&c.Yb(0,"zone-triggers",dt),2&e){var n=c.pc();c.vc("item",n.item)}}var ht={class:"backoffice-info-with-circle"},pt=function(e){return{id:"about",name:"About",template:e,icon:ht}},vt={class:"backoffice-documents"},bt=function(e,t){return{id:"systems",name:"Systems",template:e,count:t,icon:vt}},_t={class:"backoffice-stopwatch"},yt=function(e,t){return{id:"triggers",name:"Triggers",template:e,count:t,icon:_t}},Ct=function(e,t,n){return[e,t,n]},Ot=function(e){function t(t,n,c,i){var o=e.call(this,t,n,c)||this;return o._service=t,o._route=n,o._router=c,o._dialog=i,o.service=o._service.Zones,o}return a.d(t,e),t.prototype.loadValues=function(){var e=this;this._service.Systems.query({offset:0,limit:1,zone_id:this.item.id}).then(function(){return e.system_count=e._service.Systems.last_total}),this._service.SystemTriggers.query({offset:0,limit:1,zone_id:this.item.id}).then(function(){return e.trigger_count=e._service.SystemTriggers.last_total})},t.prototype.new=function(){this._dialog.open(m.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new g.r(this._service.Zones,{}),service:this._service.Zones}})},t.prototype.edit=function(){this.item&&this._dialog.open(m.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Zones}})},t.prototype.delete=function(){var e=this;if(this.item){var t=this._dialog.open(u.b,a.a({},u.a,{data:{title:"Delete zone",content:"<p>Are you sure you want delete this zone?</p><p>Deleting this zone will <strong>immediately</strong> remove systems without another zone</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(function(n){"done"===n.reason&&(t.componentInstance.loading="Deleting device...",e.item.delete().then(function(){e._service.notifySuccess('Successfully deleted device "'+e.item.name+'".'),e._router.navigate(["/zones"]),t.close(),e.unsub("delete_confirm")},function(n){t.componentInstance.loading=null,e._service.notifyError("Error deleting device. Error: "+n)}))}))}},t.ngComponentDef=c.Rb({type:t,selectors:[["app-zones"]],factory:function(e){return new(e||t)(c.Xb(l.a),c.Xb(r.a),c.Xb(r.c),c.Xb(f.b))},features:[c.Fb],consts:11,vars:18,template:function(e,t){if(1&e&&(c.ec(0,"div",ct),c.Pc(),c.ec(1,"div",it),c.ec(2,"sidebar",ot),c.kc("searchChange",function(e){return t.search(e)}),c.kc("event",function(e){return t.sidebarEvent(e)}),c.cc(),c.cc(),c.ec(3,"main",rt),c.kc("touchrelease",function(e){return t.show_sidebar=!1}),c.ec(4,"item-display",st),c.kc("event",function(e){return t.itemEvent(e)}),c.Rc(5,mt,1,1,"ng-template",null,at,c.Sc),c.Rc(7,ut,1,1,"ng-template",null,gt,c.Sc),c.Rc(9,ft,1,1,"ng-template",null,lt,c.Sc),c.cc(),c.cc(),c.cc()),2&e){var n=c.Bc(6),i=c.Bc(8),o=c.Bc(10);c.Mb("show",t.show_sidebar),c.Qc(),c.Ic(2),c.vc("module",t.module)("close",t.show_sidebar),c.Ic(4),c.vc("item",t.item)("active",t.tab)("tabs",c.yc(14,Ct,c.wc(6,pt,n),c.xc(8,bt,i,t.system_count),c.xc(11,yt,o,t.trigger_count)))}},directives:[h.a,p.b,v.a,B,Ie,nt],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}"]}),t}(d.a),Mt=[{path:"",component:Ot,children:[]},{path:":id",component:Ot,children:[]},{path:"**",redirectTo:""}],wt=n("PCNd");n.d(t,"AppZonesModule",function(){return It});var It=function(){function e(){}return e.ngModuleDef=c.Vb({type:e}),e.ngInjectorDef=c.Ub({factory:function(t){return new(t||e)},imports:[[i.c,o.g,s.b,r.g.forChild(Mt),wt.a]]}),e}();r.g.forChild(Mt)}}]);