function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{Gwc7:function(e,t,n){"use strict";n.r(t);var i,o=n("ofXK"),r=n("3Pt+"),c=n("tyNb"),a=n("CcG0"),s=n("UN3I"),d=n("OaWH"),l=n("C/ya"),b=n("g+Po"),u=n("D/9M"),m=n("fXoL"),h=n("0IaG"),f=n("BAfr"),g=n("m6yr"),v=n("47y3"),p=function(){return{class:"backoffice-info-with-circle"}},_=function(e){return{id:"about",name:"About",icon:e}},y=function(){return{class:"backoffice-tablet"}},w=function(e,t){return{id:"devices",name:"Devices",count:e,icon:t}},C=function(e,t){return[e,t]},O=((i=function(e){function t(e,n,i,o){var r;return _classCallCheck(this,t),(r=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this,e,n,i)))._service=e,r._route=n,r._router=i,r._dialog=o,r.service=r._service.Drivers,r}return _inherits(t,e),_createClass(t,[{key:"loadValues",value:function(){var e=this;this._service.Modules.query({offset:0,limit:1,dependency_id:this.item.id}).then((function(){e.device_count=e._service.Modules.last_total||0}))}},{key:"new",value:function(){var e=this;this._dialog.open(u.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new s.f(this._service.Drivers,{}),service:this._service.Drivers}}).componentInstance.event.subscribe((function(t){"done"===t.reason&&e._router.navigate(["/drivers",t.metadata.item.id])}))}},{key:"edit",value:function(){this.item&&this._dialog.open(u.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Drivers}})}},{key:"delete",value:function(){var e=this;if(this.item){var t=this._dialog.open(b.b,Object.assign(Object.assign({},b.a),{data:{title:"Delete driver",content:"<p>Are you sure you want delete this driver?</p><p>All devices that rely on this driver will be <strong>immediately</strong> removed.</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.componentInstance.loading="Deleting driver...",e.item.delete().then((function(){e._service.notifySuccess('Successfully deleted driver "'.concat(e.item.name,'".')),e._router.navigate(["/drivers"]),t.close(),e.unsub("delete_confirm")}),(function(n){t.componentInstance.loading=null,e._service.notifyError("Error deleting driver. Error: ".concat(n))})))})))}}}]),t}(l.a)).\u0275fac=function(e){return new(e||i)(m.Qb(d.a),m.Qb(c.a),m.Qb(c.c),m.Qb(h.b))},i.\u0275cmp=m.Kb({type:i,selectors:[["app-drivers"]],features:[m.zb],decls:5,vars:16,consts:[[1,"container"],[1,"sidebar"],["heading","Drivers",3,"module","close","event"],[3,"touchrelease"],["name","driver","route","drivers",3,"item","tabs","event"]],template:function(e,t){1&e&&(m.Wb(0,"div",0),m.Wb(1,"div",1),m.Wb(2,"sidebar",2),m.ec("event",(function(e){return t.sidebarEvent(e)})),m.Vb(),m.Vb(),m.Wb(3,"main",3),m.ec("touchrelease",(function(e){return t.show_sidebar=!1})),m.Wb(4,"item-display",4),m.ec("event",(function(e){return t.itemEvent(e)})),m.Vb(),m.Vb(),m.Vb()),2&e&&(m.Gb("show",t.show_sidebar),m.Cb(2),m.oc("module",t.module)("close",t.show_sidebar),m.Cb(2),m.oc("item",t.item)("tabs",m.rc(13,C,m.qc(7,_,m.pc(6,p)),m.rc(10,w,t.device_count,m.pc(9,y)))))},directives:[f.a,g.b,v.a],styles:[".container[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait)and (max-width:450px){.container[_ngcontent-%COMP%]{-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}}@media only screen and (orientation:landscape)and (max-width:800px){.container[_ngcontent-%COMP%]{-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}}@media only screen and (orientation:portrait)and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape)and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait)and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape)and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait)and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;-webkit-transition:height .3s;transition:height .3s}}@media only screen and (orientation:landscape)and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;-webkit-transition:height .3s;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;-webkit-box-flex:1;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait)and (max-width:450px){main[_ngcontent-%COMP%]{-webkit-transition:height .3s;transition:height .3s;width:100%}}@media only screen and (orientation:landscape)and (max-width:800px){main[_ngcontent-%COMP%]{-webkit-transition:height .3s;transition:height .3s;width:100%}}"]}),i),k=n("5f3J"),x=n("bTqV"),P=n("rUqb");function M(e,t){if(1&e){var n=m.Xb();m.Wb(0,"div",1),m.Wb(1,"section"),m.Wb(2,"table"),m.Wb(3,"thead"),m.Wb(4,"td",2),m.Ic(5,"Module Name"),m.Vb(),m.Wb(6,"td",3),m.Ic(7,"Class"),m.Vb(),m.Vb(),m.Wb(8,"tbody"),m.Wb(9,"tr"),m.Wb(10,"td",2),m.Ic(11),m.Vb(),m.Wb(12,"td",4),m.Ic(13),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Vb(),m.Wb(14,"section"),m.Wb(15,"button",5),m.ec("tapped",(function(e){return m.yc(n),m.ic().reloadDriver()})),m.Ic(16,"Reload Modules"),m.Vb(),m.Vb(),m.Wb(17,"header"),m.Ic(18,"Settings"),m.Vb(),m.Wb(19,"section"),m.Rb(20,"settings-form-field",6),m.Vb(),m.Vb()}if(2&e){var i=m.ic();m.Cb(11),m.Jc(null==i.item?null:i.item.module_name),m.Cb(2),m.Jc(null==i.item?null:i.item.class_name),m.Cb(7),m.oc("ngModel",i.settings)("readonly",!0)}}var W,V=((W=function(e){function t(e,n){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._dialog=e,i._service=n,i}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item",(function(t){e.item=t})))}},{key:"reloadDriver",value:function(){var e=this;if(this.item){var t=this._dialog.open(b.b,Object.assign(Object.assign({},b.a),{data:{title:"Reload Driver",content:"<p>Are you sure you want reload this driver?</p><p>New driver code will be loaded and device settings will be updated.</p>",icon:{type:"icon",class:"backoffice-cycle"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe((function(n){"done"===n.reason&&(t.componentInstance.loading="Reloading driver...",e.item.reload().then((function(){e._service.notifySuccess('Successfully reloaded driver "'.concat(e.item.name,'".')),t.close(),e.unsub("delete_confirm")}),(function(n){t.componentInstance.loading=null,e._service.notifyError("Error reloading driver. Error: ".concat(n))})))})))}}},{key:"settings",get:function(){return this.item.settings.settings_string}}]),t}(k.a)).\u0275fac=function(e){return new(e||W)(m.Qb(h.b),m.Qb(d.a))},W.\u0275cmp=m.Kb({type:W,selectors:[["driver-about"]],inputs:{item:"item"},features:[m.zb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"flex"],[1,"class"],[1,"class","mono"],["mat-button","",3,"tapped"],[3,"ngModel","readonly"]],template:function(e,t){1&e&&m.Gc(0,M,21,4,"div",0),2&e&&m.oc("ngIf",t.item)},directives:[o.m,x.b,g.b,P.a,r.k,r.n],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}.table-row[_ngcontent-%COMP%]   .class[_ngcontent-%COMP%]{width:12em;min-width:12em}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),W),I=n("XNiG"),j=n("LRne"),D=n("Kj3r"),E=n("/uUt"),R=n("eIep"),G=n("JIr8"),A=n("lJxs"),q=n("kmnG"),F=n("0njA"),J=n("qFsG"),N=function(e){return["/modules",e]},S=function(e){return["/systems",e]};function z(e,t){if(1&e){var n=m.Xb();m.Wb(0,"tr"),m.Wb(1,"td",11),m.Rb(2,"div",15),m.Wb(3,"i",16),m.ec("modelChange",(function(e){return m.yc(n),t.$implicit.enabled=e})),m.Vb(),m.Vb(),m.Wb(4,"td",12),m.Wb(5,"a",17),m.Ic(6),m.Vb(),m.Vb(),m.Wb(7,"td",13),m.Wb(8,"a",17),m.Ic(9),m.Wb(10,"span",18),m.Ic(11),m.Vb(),m.Ic(12,") "),m.Vb(),m.Vb(),m.Wb(13,"td",11),m.Wb(14,"button",19),m.ec("tapped",(function(e){m.yc(n);var i=t.$implicit;return m.ic(3).removeDevice(i)})),m.Rb(15,"i",20),m.Vb(),m.Vb(),m.Vb()}if(2&e){var i=t.$implicit;m.Cb(2),m.Gb("active",i.enabled),m.Cb(1),m.oc("model",i.enabled)("sys",i.system.id)("mod",i.module_name),m.Cb(2),m.oc("routerLink",m.qc(10,N,i.id)),m.Cb(1),m.Jc(i.name),m.Cb(2),m.oc("routerLink",m.qc(12,S,i.system.id)),m.Cb(1),m.Kc(" ",null==i.system?null:i.system.name," ("),m.Cb(2),m.Jc(null==i.system?null:i.system.id)}}function K(e,t){if(1&e&&(m.Wb(0,"table"),m.Wb(1,"thead"),m.Rb(2,"td",11),m.Wb(3,"td",12),m.Ic(4,"Name"),m.Vb(),m.Wb(5,"td",13),m.Ic(6,"System"),m.Vb(),m.Rb(7,"td",11),m.Vb(),m.Wb(8,"tbody"),m.Gc(9,z,16,14,"tr",14),m.Vb(),m.Vb()),2&e){var n=m.ic(2);m.Cb(9),m.oc("ngForOf",n.device_list)}}function L(e,t){1&e&&(m.Wb(0,"div",21),m.Wb(1,"div",22),m.Ic(2,"No devices with driver"),m.Vb(),m.Vb())}var Q=function(){return{class:"backoffice-magnifying-glass"}};function $(e,t){if(1&e){var n=m.Xb();m.Wb(0,"div",1),m.Wb(1,"div",2),m.Wb(2,"section",3),m.Wb(3,"mat-form-field",4),m.Wb(4,"div",5),m.Rb(5,"app-icon",6),m.Vb(),m.Wb(6,"input",7),m.ec("ngModelChange",(function(e){return m.yc(n),m.ic().search_str=e}))("ngModelChange",(function(e){return m.yc(n),m.ic().search$.next(e)})),m.Vb(),m.Vb(),m.Vb(),m.Wb(7,"section",8),m.Gc(8,K,10,1,"table",9),m.Gc(9,L,3,0,"div",10),m.Vb(),m.Vb(),m.Vb()}if(2&e){var i=m.ic();m.Cb(5),m.oc("icon",m.pc(4,Q)),m.Cb(1),m.oc("ngModel",i.search_str),m.Cb(2),m.oc("ngIf",i.device_list&&i.device_list.length>0),m.Cb(1),m.oc("ngIf",!i.device_list||i.device_list.length<=0)}}var T,X=[{path:"",component:O,children:[]},{path:":id",component:O,children:[{path:"about",component:V},{path:"about",component:(T=function(e){function t(e,n){var i;return _classCallCheck(this,t),(i=_possibleConstructorReturn(this,_getPrototypeOf(t).call(this)))._service=e,i._dialog=n,i.device_list=[],i.search$=new I.a,i}return _inherits(t,e),_createClass(t,[{key:"ngOnInit",value:function(){var e=this;this.subscription("item",this._service.listen("BACKOFFICE.active_item",(function(t){e.item=t,e.loadDevices()}))),this.search_results$=this.search$.pipe(Object(D.a)(400),Object(E.a)(),Object(R.a)((function(t){return e.loading=!0,e._service.Modules.query({q:t,dependency_id:e.item.id,offset:0,limit:500})})),Object(G.a)((function(e){return console.error(e),Object(j.a)([])})),Object(A.a)((function(t){e.loading=!1;var n=e.search_str.toLowerCase();return t.filter((function(e){return e.name.toLowerCase().indexOf(n)>=0||(e.email||"").toLowerCase().indexOf(n)>=0}))}))),this.subscription("search_results",this.search_results$.subscribe((function(t){return e.device_list=t})))}},{key:"ngOnChanges",value:function(e){e.item&&this.loadDevices()}},{key:"loadDevices",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.item&&this._service.Modules.query({dependency_id:this.item.id,offset:t,limit:500}).then((function(t){return e.device_list=t}),(function(){return null}))}},{key:"removeDevice",value:function(e){var t=this;if(e){var n=this._dialog.open(b.b,Object.assign(Object.assign({},b.a),{data:{title:"Delete device",content:"<p>Are you sure you want delete this device?</p><p>Deleting this will device <strong>immediately</strong> remove it from any system associated with it</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe((function(i){"done"===i.reason&&(n.componentInstance.loading="Deleting device...",e.delete().then((function(){t._service.notifySuccess('Successfully deleted device "'.concat(e.name,'".')),t.loadDevices(),n.close(),t.unsub("delete_confirm")}),(function(e){n.componentInstance.loading=null,t._service.notifyError("Error deleting device. Error: ".concat(e))})))})))}}}]),t}(k.a),T.\u0275fac=function(e){return new(e||T)(m.Qb(d.a),m.Qb(h.b))},T.\u0275cmp=m.Kb({type:T,selectors:[["driver-devices"]],inputs:{item:"item"},features:[m.zb,m.Ab()],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"settings"],[1,"select"],["appearance","outline"],["matPrefix","",1,"prefix"],[3,"icon"],["matInput","","name","search-filter","placeholder","Filter Devices",3,"ngModel","ngModelChange"],[1,"list"],[4,"ngIf"],["class","info-block",4,"ngIf"],[1,"small"],[1,"flex"],[1,"system"],[4,"ngFor","ngForOf"],[1,"state"],["binding","","bind","connected",3,"model","sys","mod","modelChange"],[3,"routerLink"],[1,"id"],["mat-icon-button","",3,"tapped"],[1,"backoffice-trash"],[1,"info-block"],[1,"text"]],template:function(e,t){1&e&&m.Gc(0,$,10,5,"div",0),2&e&&m.oc("ngIf",t.item)},directives:[o.m,q.b,q.e,F.a,J.a,r.b,r.k,r.n,o.l,a.a,c.f,x.b,g.b],styles:[".container[_ngcontent-%COMP%]{padding:1em}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.list[_ngcontent-%COMP%]{margin-top:.5em}.table-row[_ngcontent-%COMP%]   .system[_ngcontent-%COMP%]{width:12em;min-width:12em}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;-webkit-transition:margin .25s,height .25s,width .25s,background-color .3s;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.select[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{-webkit-box-flex:1;flex:1}"]}),T)},{path:"**",redirectTo:"about"}]},{path:"**",redirectTo:""}],B=n("PCNd");n.d(t,"AppDriversModule",(function(){return U}));var H,U=((H=function e(){_classCallCheck(this,e)}).\u0275mod=m.Ob({type:H}),H.\u0275inj=m.Nb({factory:function(e){return new(e||H)},imports:[[o.c,r.g,a.b,c.g.forChild(X),B.a]]}),H)}}]);