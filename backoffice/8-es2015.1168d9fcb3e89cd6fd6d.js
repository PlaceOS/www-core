(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{aCzL:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),o=i("3Pt+"),c=i("tyNb"),s=i("CcG0"),a=i("UN3I"),r=i("OaWH"),d=i("C/ya"),l=i("D/9M"),h=i("g+Po"),b=i("fXoL"),u=i("0IaG"),m=i("BAfr"),p=i("m6yr"),g=i("47y3");const f=function(){return{class:"backoffice-publish"}},_=function(t,e){return{id:"applications",name:"Applications",count:t,icon:e}},w=function(){return{class:"backoffice-lock-open"}},v=function(t,e){return{id:"authentication",name:"Authentication",count:t,icon:e}},C=function(){return{class:"backoffice-users"}},y=function(t,e){return{id:"users",name:"Users",count:t,icon:e}},O=function(t,e,i){return[t,e,i]};let x=(()=>{class t extends d.a{constructor(t,e,i,n){super(t,e,i),this._service=t,this._route=e,this._router=i,this._dialog=n,this.service=this._service.Domains}loadValues(){let t={offset:0,limit:1,owner:this.item.id};this._service.Applications.query(t).then(()=>this.applications=this._service.Applications.last_total),t={offset:0,limit:1,authority_id:this.item.id},this._service.Users.query(t).then(()=>this.user_count=this._service.Users.last_total)}new(){this._dialog.open(l.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new a.e(this._service.Domains,{}),service:this._service.Domains}}).componentInstance.event.subscribe(t=>{"done"===t.reason&&this._router.navigate(["/domains",t.metadata.item.id])})}edit(){this.item&&this._dialog.open(l.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Domains}})}delete(){if(this.item){const t=this._dialog.open(h.b,Object.assign(Object.assign({},h.a),{data:{title:"Delete domain",content:"<p>Are you sure you want delete this domain?</p><p>The domain will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(e=>{"done"===e.reason&&(t.componentInstance.loading="Deleting domain...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted domain "${this.item.name}".`),this._router.navigate(["/users"]),t.close(),this.unsub("delete_confirm")},e=>{t.componentInstance.loading=null,this._service.notifyError(`Error deleting domain. Error: ${e}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(r.a),b.Qb(c.a),b.Qb(c.c),b.Qb(u.b))},t.\u0275cmp=b.Kb({type:t,selectors:[["app-domains"]],features:[b.zb],decls:5,vars:22,consts:[[1,"container"],[1,"sidebar"],["heading","Domains",3,"module","close","event"],[3,"touchrelease"],["name","domain","route","domains",3,"item","tabs","event"]],template:function(t,e){1&t&&(b.Wb(0,"div",0),b.Wb(1,"div",1),b.Wb(2,"sidebar",2),b.ec("event",(function(t){return e.sidebarEvent(t)})),b.Vb(),b.Vb(),b.Wb(3,"main",3),b.ec("touchrelease",(function(){return e.show_sidebar=!1})),b.Wb(4,"item-display",4),b.ec("event",(function(t){return e.itemEvent(t)})),b.Vb(),b.Vb(),b.Vb()),2&t&&(b.Gb("show",e.show_sidebar),b.Cb(2),b.oc("module",e.module)("close",e.show_sidebar),b.Cb(2),b.oc("item",e.item)("tabs",b.sc(18,O,b.rc(7,_,e.applications||0,b.pc(6,f)),b.rc(11,v,e.auth_sources||0,b.pc(10,w)),b.rc(15,y,e.user_count||0,b.pc(14,C)))))},directives:[m.a,p.b,g.a],styles:[".container[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;-webkit-transition:height .3s;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;-webkit-transition:height .3s;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;-webkit-box-flex:1;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{-webkit-transition:height .3s;transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{-webkit-transition:height .3s;transition:height .3s;width:100%}}"]}),t})();var k=i("5f3J"),W=i("bTqV"),P=i("0njA");const V=function(){return{class:"backoffice-edit"}},M=function(){return{class:"backoffice-trash"}};function I(t,e){if(1&t){const t=b.Xb();b.Wb(0,"tr"),b.Wb(1,"td",7),b.Ic(2),b.Vb(),b.Wb(3,"td",8),b.Ic(4),b.Vb(),b.Wb(5,"td",9),b.Ic(6),b.Vb(),b.Wb(7,"td",10),b.Wb(8,"button",12),b.ec("tapped",(function(){b.yc(t);const i=e.$implicit;return b.ic(3).editApplication(i)})),b.Rb(9,"app-icon",13),b.Vb(),b.Wb(10,"button",12),b.ec("tapped",(function(){b.yc(t);const i=e.$implicit;return b.ic(3).deleteApplication(i)})),b.Rb(11,"app-icon",13),b.Vb(),b.Vb(),b.Vb()}if(2&t){const t=e.$implicit;b.Cb(2),b.Jc(t.name),b.Cb(2),b.Jc(t.redirect),b.Cb(2),b.Jc(t.scope),b.Cb(3),b.oc("icon",b.pc(5,V)),b.Cb(2),b.oc("icon",b.pc(6,M))}}function A(t,e){if(1&t&&(b.Wb(0,"div",6),b.Wb(1,"table"),b.Wb(2,"thead"),b.Wb(3,"td",7),b.Ic(4,"Name"),b.Vb(),b.Wb(5,"td",8),b.Ic(6,"Redirect"),b.Vb(),b.Wb(7,"td",9),b.Ic(8,"Scope"),b.Vb(),b.Rb(9,"td",10),b.Vb(),b.Wb(10,"tbody"),b.Gc(11,I,12,7,"tr",11),b.Vb(),b.Vb(),b.Vb()),2&t){const t=b.ic(2);b.Cb(11),b.oc("ngForOf",t.application_list)}}function S(t,e){1&t&&(b.Wb(0,"div",14),b.Wb(1,"div",15),b.Ic(2,"No applications found"),b.Vb(),b.Vb())}function E(t,e){if(1&t){const t=b.Xb();b.Wb(0,"div",1),b.Wb(1,"section",2),b.Wb(2,"button",3),b.ec("tapped",(function(){return b.yc(t),b.ic().newApplication()})),b.Ic(3,"Add new"),b.Vb(),b.Vb(),b.Wb(4,"section"),b.Gc(5,A,12,1,"div",4),b.Gc(6,S,3,0,"div",5),b.Vb(),b.Vb()}if(2&t){const t=b.ic();b.Cb(5),b.oc("ngIf",t.application_list&&t.application_list.length>0),b.Cb(1),b.oc("ngIf",!t.application_list||t.application_list.length<=0)}}let D=(()=>{class t extends k.a{constructor(t,e){super(),this._service=t,this._dialog=e}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadApplications()}))}ngOnChanges(t){t.item&&this.loadApplications()}loadApplications(t=0){this.item&&this._service.Applications.query({owner:this.item.id,offset:t}).then(e=>{t||(this.application_list=[]);for(const t of e||[]){let e=!1;for(const i of this.application_list)if(i.id===t.id){e=!0;break}e||this.application_list.push(t)}},()=>null)}newApplication(){this._dialog.open(l.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new a.c(this._service.Applications,{}),service:this._service.Applications}})}editApplication(t){this.item&&this._dialog.open(l.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,service:this._service.Applications}})}deleteApplication(t){if(t){const e=this._dialog.open(h.b,Object.assign(Object.assign({},h.a),{data:{title:"Delete application",content:`<p>Are you sure you want delete the application ${t.name}?</p><p>Configuration will be <strong>immediately</strong> updated</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting application...",t.delete().then(()=>{this._service.notifySuccess(`Successfully deleted application "${t.name}".`),this.loadApplications(),e.close(),this.unsub("delete_confirm")},t=>{e.componentInstance.loading=null,this._service.notifyError(`Error deleting application. Error: ${t}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(r.a),b.Qb(u.b))},t.\u0275cmp=b.Kb({type:t,selectors:[["domain-applications"]],inputs:{item:"item"},features:[b.zb,b.Ab()],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"scope"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&b.Gc(0,E,7,2,"div",0),2&t&&b.oc("ngIf",e.item)},directives:[n.m,W.b,p.b,n.l,P.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:-webkit-box;display:flex;font-size:1.2em;max-width:5em;margin:0}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;-webkit-transition:margin .25s,height .25s,width .25s,background-color .3s;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.duo[_ngcontent-%COMP%]{width:6em}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .scope[_ngcontent-%COMP%]{width:8em;min-width:8em}.select[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})();var F=i("dQMc");const j=function(){return{class:"backoffice-edit"}},G=function(){return{class:"backoffice-trash"}};function $(t,e){if(1&t){const t=b.Xb();b.Wb(0,"tr"),b.Wb(1,"td",6),b.Ic(2),b.Vb(),b.Wb(3,"td",7),b.Ic(4),b.Vb(),b.Wb(5,"td",8),b.Wb(6,"button",10),b.ec("tapped",(function(){b.yc(t);const i=e.$implicit;return b.ic(2).editAuthSource(i)})),b.Rb(7,"app-icon",11),b.Vb(),b.Wb(8,"button",10),b.ec("tapped",(function(){b.yc(t);const i=e.$implicit;return b.ic(2).deleteAuthSource(i)})),b.Rb(9,"app-icon",11),b.Vb(),b.Vb(),b.Vb()}if(2&t){const t=e.$implicit,i=b.ic(2);b.Cb(2),b.Jc(t.name),b.Cb(2),b.Jc(i.source_types[t.id]),b.Cb(3),b.oc("icon",b.pc(4,j)),b.Cb(2),b.oc("icon",b.pc(5,G))}}function J(t,e){if(1&t&&(b.Wb(0,"div",5),b.Wb(1,"table"),b.Wb(2,"thead"),b.Wb(3,"td",6),b.Ic(4,"Name"),b.Vb(),b.Wb(5,"td",7),b.Ic(6,"Type"),b.Vb(),b.Rb(7,"td",8),b.Vb(),b.Wb(8,"tbody"),b.Gc(9,$,10,6,"tr",9),b.Vb(),b.Vb(),b.Vb()),2&t){const t=b.ic();b.Cb(9),b.oc("ngForOf",t.auth_sources)}}function z(t,e){1&t&&(b.Wb(0,"div",12),b.Wb(1,"div",13),b.Ic(2,"No authentication sources found"),b.Vb(),b.Vb())}function N(t,e){if(1&t&&(b.Wb(0,"tr"),b.Wb(1,"td",4),b.Ic(2),b.Vb(),b.Wb(3,"td",5),b.Ic(4),b.Vb(),b.Wb(5,"td",6),b.Ic(6),b.Vb(),b.Vb()),2&t){const t=e.$implicit;b.Cb(2),b.Jc(t.name),b.Cb(2),b.Jc(t.email),b.Cb(2),b.Jc(t.role)}}function Q(t,e){if(1&t&&(b.Wb(0,"div",3),b.Wb(1,"table"),b.Wb(2,"thead"),b.Wb(3,"td",4),b.Ic(4,"Name"),b.Vb(),b.Wb(5,"td",5),b.Ic(6,"Email"),b.Vb(),b.Wb(7,"td",6),b.Ic(8,"Role"),b.Vb(),b.Vb(),b.Wb(9,"tbody"),b.Gc(10,N,7,3,"tr",7),b.Vb(),b.Vb(),b.Vb()),2&t){const t=b.ic();b.Cb(10),b.oc("ngForOf",t.model.list)}}function U(t,e){1&t&&(b.Wb(0,"div",8),b.Wb(1,"div",9),b.Ic(2,"No users found"),b.Vb(),b.Vb())}const q=[{path:"",component:x,children:[]},{path:":id",component:x,children:[{path:"applications",component:D},{path:"authentication",component:(()=>{class t extends k.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.auth_sources=[],this.source_types={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadAuthSources()}))}ngOnChanges(t){t.item&&this.loadAuthSources()}loadAuthSources(t=0){this.item&&Promise.all([this._service.OAuthSources.query({authority_id:this.item.id,offset:t}),this._service.SAMLAuthSources.query({authority_id:this.item.id,offset:t}),this._service.LDAPAuthSources.query({authority_id:this.item.id,offset:t})]).then(e=>{t||(this.auth_sources=[]);for(const t of e)t.forEach(t=>this.addAuthSourceToList(t))},()=>null)}newAuthSource(){this._dialog.open(F.a,{width:"auto",height:"auto",data:{domain:this.item}}).afterClosed().subscribe(()=>this.loadAuthSources())}editAuthSource(t){this._dialog.open(F.a,{width:"auto",height:"auto",data:{domain:this.item,auth_source:t}}).afterClosed().subscribe(()=>this.loadAuthSources())}deleteAuthSource(t){if(t){const e=this._dialog.open(h.b,Object.assign(Object.assign({},h.a),{data:{title:"Delete auth source",content:"<p>Are you sure you want delete this auth source?</p><p>Deleting this will device <strong>immediately</strong> remove it from any system associated with it</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting auth source...",t.delete().then(()=>{this._service.notifySuccess("Successfully deleted auth source."),e.close(),this.unsub("delete_confirm"),this.loadAuthSources()},t=>{this._service.notifyError(`Error deleting auth source. Error ${t.message||t}`),e.componentInstance.loading=null}))}))}}addAuthSourceToList(t){this.source_types[t.id]=t instanceof a.l?"saml":t instanceof a.g?"ldap":"oauth";const e=this.auth_sources.findIndex(e=>e.id===t.id);e<0?this.auth_sources.push(t):this.auth_sources.splice(e,1,t)}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(r.a),b.Qb(u.b))},t.\u0275cmp=b.Kb({type:t,selectors:[["domain-authentication"]],inputs:{item:"item"},features:[b.zb,b.Ab()],decls:8,vars:2,consts:[[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf","ngIfElse"],["no_auth_sources",""],[1,"list"],[1,"name"],[1,"flex"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){if(1&t&&(b.Wb(0,"div",0),b.Wb(1,"section",1),b.Wb(2,"button",2),b.ec("tapped",(function(){return e.newAuthSource()})),b.Ic(3,"Add new"),b.Vb(),b.Vb(),b.Wb(4,"section"),b.Gc(5,J,10,1,"div",3),b.Vb(),b.Vb(),b.Gc(6,z,3,0,"ng-template",null,4,b.Hc)),2&t){const t=b.vc(7);b.Cb(5),b.oc("ngIf",e.auth_sources&&e.auth_sources.length>0)("ngIfElse",t)}},directives:[W.b,p.b,n.m,n.l,P.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%], .options[_ngcontent-%COMP%]{display:-webkit-box;display:flex}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;-webkit-transition:margin .25s,height .25s,width .25s,background-color .3s;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}.duo[_ngcontent-%COMP%]{width:6em;text-align:right}"]}),t})()},{path:"users",component:(()=>{class t extends k.a{constructor(t){super(),this._service=t,this.model={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadUsers()})),this.loadUsers()}ngOnChanges(t){t.item&&this.loadUsers()}loadUsers(t=0){this.item&&this._service.Users.query({authority_id:this.item.id,offset:t}).then(e=>{t||(this.model.list=[]);for(const t of e||[]){let e=!1;for(const i of this.model.list)if(i.id===t.id){e=!0;break}e||this.model.list.push(t)}},()=>null)}}return t.\u0275fac=function(e){return new(e||t)(b.Qb(r.a))},t.\u0275cmp=b.Kb({type:t,selectors:[["domain-users"]],inputs:{item:"item"},features:[b.zb,b.Ab()],decls:4,vars:2,consts:[[1,"container"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"role"],[4,"ngFor","ngForOf"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&(b.Wb(0,"div",0),b.Wb(1,"section"),b.Gc(2,Q,11,1,"div",1),b.Gc(3,U,3,0,"div",2),b.Vb(),b.Vb()),2&t&&(b.Cb(2),b.oc("ngIf",e.model.list&&e.model.list.length>0),b.Cb(1),b.oc("ngIf",!e.model.list||e.model.list.length<=0))},directives:[n.m,n.l],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%], .options[_ngcontent-%COMP%]{display:-webkit-box;display:flex}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:12em;min-width:12em}.table-row[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;-webkit-transition:margin .25s,height .25s,width .25s,background-color .3s;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})()},{path:"**",redirectTo:"applications"}]},{path:"**",redirectTo:""}];var K=i("PCNd");i.d(e,"AppDomainsModule",(function(){return R}));let R=(()=>{class t{}return t.\u0275mod=b.Ob({type:t}),t.\u0275inj=b.Nb({factory:function(e){return new(e||t)},imports:[[n.c,o.g,s.b,c.g.forChild(q),K.a]]}),t})()}}]);