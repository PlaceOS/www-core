(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{FWSw:function(e,t,n){"use strict";n.r(t);var c=n("fXoL"),i=n("ofXK"),s=n("3Pt+"),o=n("tyNb"),r=n("CcG0"),a=n("UN3I"),g=n("OaWH"),l=n("C/ya"),d=n("D/9M"),m=n("g+Po"),h=n("LcAk"),f=n("BAfr"),u=n("m6yr"),p=n("47y3"),v=n("5f3J"),_=n("rUqb"),b=n("IRfi"),y=n("2+6u"),C=n("j14s"),O=n("Mj3r"),M=n("TURh");const w=[1,"container"],I=[4,"ngIf"],P=["class","tags",4,"ngIf"],x=[3,"ngModel","readonly"];function T(e,t){1&e&&(c.ec(0,"header"),c.Tc(1,"Execute Command"),c.cc())}const k=["appearance","outline"],S=["placeholder","Select system",3,"ngModel","ngModelChange"],z=[3,"value",4,"ngFor","ngForOf"],R=[3,"system",4,"ngIf"],F=[3,"value"];function E(e,t){if(1&e&&(c.ec(0,"mat-option",F),c.Tc(1),c.cc()),2&e){const e=t.$implicit;c.vc("value",e),c.Ic(1),c.Vc(" ",e.name," ")}}const $=[3,"system"];function j(e,t){if(1&e&&c.Yb(0,"system-exec-field",$),2&e){const e=c.pc(2);c.vc("system",e.active_system)}}function A(e,t){if(1&e){const e=c.fc();c.ec(0,"section"),c.ec(1,"mat-form-field",k),c.ec(2,"mat-select",S),c.kc("ngModelChange",function(t){return c.Ec(e),c.pc().active_system=t}),c.Rc(3,E,2,2,"mat-option",z),c.cc(),c.cc(),c.Rc(4,j,1,1,"system-exec-field",R),c.cc()}if(2&e){const e=c.pc();c.Ic(2),c.vc("ngModel",e.active_system),c.Ic(3),c.vc("ngForOf",e.system_list),c.Ic(4),c.vc("ngIf",e.active_system&&e.active_system.id)}}const D=[1,"tags"],X=["for","tags"],L=[1,"value"],U=["name","tags"],Y=[4,"ngFor","ngForOf"];function N(e,t){if(1&e&&(c.ec(0,"mat-chip"),c.Tc(1),c.cc()),2&e){const e=t.$implicit;c.Ic(1),c.Uc(e)}}function q(e,t){if(1&e&&(c.ec(0,"section",D),c.ec(1,"label",X),c.Tc(2,"Tags:"),c.cc(),c.ec(3,"div",L),c.ec(4,"mat-chip-list",U),c.Rc(5,N,2,1,"mat-chip",Y),c.cc(),c.cc(),c.cc()),2&e){const e=c.pc();c.Ic(5),c.vc("ngForOf",e.tag_list)}}const B=(()=>{class e extends v.a{constructor(e){super(),this._service=e}ngOnChanges(e){e.item&&this.item&&this.loadSystems()}get settings(){return this.item.settings.settings_string}loadSystems(e=0){this._service.Systems.query({offset:e,zone_id:this.item.id,limit:500}).then(e=>{this.system_list=e})}get tag_list(){return this.item&&this.item.tags?this.item.tags.split(","):[]}}return e.ngComponentDef=c.Rb({type:e,selectors:[["zone-about"]],factory:function(t){return new(t||e)(c.Xb(g.a))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:8,vars:5,template:function(e,t){1&e&&(c.ec(0,"div",w),c.Rc(1,T,2,0,"header",I),c.Rc(2,A,5,3,"section",I),c.Rc(3,q,6,1,"section",P),c.ec(4,"header"),c.Tc(5,"Settings"),c.cc(),c.ec(6,"section"),c.Yb(7,"settings-form-field",x),c.cc(),c.cc()),2&e&&(c.Ic(1),c.vc("ngIf",t.system_list&&t.system_list.length),c.Ic(2),c.vc("ngIf",t.system_list&&t.system_list.length),c.Ic(3),c.vc("ngIf",t.item&&t.tag_list),c.Ic(7),c.vc("ngModel",t.settings)("readonly",!0))},directives:[i.n,_.a,s.k,s.n,b.b,y.a,i.m,C.h,O.a,M.c,M.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.tags[_ngcontent-%COMP%]{display:flex}label[_ngcontent-%COMP%]{font-size:.8em;font-weight:500;padding:.75em .5em}"]}),e})();var G=n("XNiG"),Z=n("LRne"),J=n("Kj3r"),V=n("/uUt"),W=n("eIep"),H=n("JIr8"),K=n("lJxs"),Q=n("0njA"),ee=n("A2Vd");const te=[1,"container"],ne=[1,"btn"],ce=["appearance","outline"],ie=["matPrefix","",1,"prefix"],se=[3,"icon"],oe=["matInput","","name","search-filter","placeholder","Filter Systems",3,"ngModel","ngModelChange"],re=["class","list",4,"ngIf","ngIfElse"],ae=["empty_state",""],ge=[1,"list"],le=[1,"flex"],de=[1,"devices"],me=[1,"created"],he=[4,"ngFor","ngForOf"],fe=["routerLinkActive","router-link-active",3,"routerLink"],ue=[1,"id"],pe=[1,"devices","align-right"],ve=function(e){return["/systems",e]};function _e(e,t){if(1&e&&(c.ec(0,"tr"),c.ec(1,"td",le),c.ec(2,"a",fe),c.Tc(3),c.ec(4,"span",ue),c.Tc(5),c.cc(),c.Tc(6,") "),c.cc(),c.cc(),c.ec(7,"td",pe),c.Tc(8),c.cc(),c.ec(9,"td",me),c.Tc(10),c.cc(),c.cc()),2&e){const e=t.$implicit;c.Ic(2),c.vc("routerLink",c.wc(5,ve,e.id)),c.Ic(3),c.Vc(" ",e.name," ("),c.Ic(5),c.Uc(e.id),c.Ic(8),c.Uc(e.installed_ui_devices),c.Ic(10),c.Uc(null==e.display?null:e.display.created)}}function be(e,t){if(1&e&&(c.ec(0,"div",ge),c.ec(1,"table"),c.ec(2,"thead"),c.ec(3,"td",le),c.Tc(4,"Name"),c.cc(),c.ec(5,"td",de),c.Tc(6,"No. Devices"),c.cc(),c.ec(7,"td",me),c.Tc(8,"Created"),c.cc(),c.cc(),c.ec(9,"tbody"),c.Rc(10,_e,11,7,"tr",he),c.cc(),c.cc(),c.cc()),2&e){const e=c.pc();c.Ic(10),c.vc("ngForOf",e.system_list)}}const ye=[1,"info-block"],Ce=[1,"text"];function Oe(e,t){1&e&&(c.ec(0,"div",ye),c.ec(1,"div",Ce),c.Tc(2,"No systems found"),c.cc(),c.cc())}const Me={class:"backoffice-magnifying-glass"},we=(()=>{class e extends v.a{constructor(e){super(),this._service=e,this.system_list=[],this.search$=new G.a}ngOnInit(){this.search_results$=this.search$.pipe(Object(J.a)(400),Object(V.a)(),Object(W.a)(e=>(this.loading=!0,this._service.Systems.query({q:e,module_id:this.item.id,offset:0}))),Object(H.a)(e=>(console.error(e),Object(Z.a)([]))),Object(K.a)(e=>{this.loading=!1;const t=this.search_str.toLowerCase();return e.filter(e=>e.name.toLowerCase().indexOf(t)>=0||(e.email||"").toLowerCase().indexOf(t)>=0)})),this.search$.next(""),this.subscription("search_results",this.search_results$.subscribe(e=>this.system_list=e))}ngOnChanges(e){e.item&&this.loadSystems()}loadSystems(e=0){this._service.Systems.query({offset:e,zone_id:this.item.id,limit:500}).then(e=>this.system_list=e)}}return e.ngComponentDef=c.Rb({type:e,selectors:[["zone-systems"]],factory:function(t){return new(t||e)(c.Xb(g.a))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:9,vars:4,template:function(e,t){if(1&e&&(c.ec(0,"div",te),c.ec(1,"div",ne),c.ec(2,"mat-form-field",ce),c.ec(3,"div",ie),c.Yb(4,"app-icon",se),c.cc(),c.ec(5,"input",oe),c.kc("ngModelChange",function(e){return t.search_str=e}),c.kc("ngModelChange",function(e){return t.search$.next(e)}),c.cc(),c.cc(),c.cc(),c.Rc(6,be,11,1,"div",re),c.cc(),c.Rc(7,Oe,3,0,"ng-template",null,ae,c.Sc)),2&e){const e=c.Bc(8);c.Ic(4),c.vc("icon",Me),c.Ic(5),c.vc("ngModel",t.search_str),c.Ic(6),c.vc("ngIf",t.system_list&&t.system_list.length>0)("ngIfElse",e)}},directives:[b.b,b.e,Q.a,ee.a,s.b,s.k,s.n,i.n,i.m,o.f,o.e],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}mat-form-field[_ngcontent-%COMP%]{width:100%}mat-form-field[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}.table-row[_ngcontent-%COMP%]   .created[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .devices[_ngcontent-%COMP%]{width:10em}"]}),e})();var Ie=n("YxBP"),Pe=n("uxQG"),xe=n("Xlwt");const Te=[1,"container"],ke=[1,"settings"],Se=[1,"select"],ze=[1,"dropdown"],Re=["mat-button","",3,"tapped"],Fe=["appearance","outline"],Ee=["matPrefix","",1,"prefix"],$e=[3,"icon"],je=["matInput","","name","search-filter","placeholder","Filter Triggers",3,"ngModel","ngModelChange"],Ae=[1,"list"],De=[4,"ngIf"],Xe=["class","info-block",4,"ngIf"],Le=[1,"name"],Ue=[1,"flex"],Ye=[1,"small"],Ne=[4,"ngFor","ngForOf"],qe=[3,"routerLink"],Be=[1,"flex","description"],Ge=["mat-icon-button","",3,"tapped"],Ze=function(e){return["/triggers",e]},Je={class:"backoffice-trash"};function Ve(e,t){if(1&e){const e=c.fc();c.ec(0,"tr"),c.ec(1,"td",Le),c.ec(2,"a",qe),c.Tc(3),c.cc(),c.cc(),c.ec(4,"td",Be),c.Tc(5),c.cc(),c.ec(6,"td",Ye),c.ec(7,"button",Ge),c.kc("tapped",function(n){c.Ec(e);const i=t.$implicit;return c.pc(2).deleteTrigger(i)}),c.Yb(8,"app-icon",$e),c.cc(),c.cc(),c.cc()}if(2&e){const e=t.$implicit;c.Ic(2),c.vc("routerLink",c.wc(4,Ze,e.id)),c.Ic(3),c.Uc(e.name),c.Ic(5),c.Uc(e.description),c.Ic(8),c.vc("icon",Je)}}function We(e,t){if(1&e&&(c.ec(0,"table"),c.ec(1,"thead"),c.ec(2,"td",Le),c.Tc(3,"Name"),c.cc(),c.ec(4,"td",Ue),c.Tc(5,"Description"),c.cc(),c.Yb(6,"td",Ye),c.cc(),c.ec(7,"tbody"),c.Rc(8,Ve,9,6,"tr",Ne),c.cc(),c.cc()),2&e){const e=c.pc();c.Ic(8),c.vc("ngForOf",e.model.triggers)}}const He=[1,"info-block"],Ke=[1,"text"];function Qe(e,t){1&e&&(c.ec(0,"div",He),c.ec(1,"div",Ke),c.Tc(2,"No triggers for zone"),c.cc(),c.cc())}const et={class:"backoffice-magnifying-glass"},tt=(()=>{class e extends v.a{constructor(e,t){super(),this._service=e,this._dialog=t,this.model={}}ngOnChanges(e){e.item&&this.load()}load(e=0){this._service.SystemTriggers.query({zone_id:this.item.id,offset:e}).then(e=>{this.model.triggers=e},()=>null)}deleteTrigger(e){if(this.item&&e){const t=this.item.triggers.indexOf(e.id);if(t<0)return;const n=this._dialog.open(m.b,Object.assign({},m.a,{data:{title:"Remove trigger",content:`<p>Are you sure you want remove trigger "${e.name}"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",n.componentInstance.event.subscribe(e=>{if("done"===e.reason){n.componentInstance.loading="Removing trigger...";const e=[...this.item.triggers];e.splice(t,1),this.item.storePendingChange("triggers",e),this.item.save().then(()=>this._service.notifySuccess("Sucessfully removed trigger"),e=>this._service.notifyError(`Error removing trigger. Error: ${e.message||e}`)),n.close(),this.unsub("delete_confirm")}}))}}selectTriggerToAdd(){const e=this._dialog.open(Pe.a,{height:"auto",width:"auto",data:{service_name:"Triggers"}});this.subscription("dialog_events",e.componentInstance.event.subscribe(t=>{const n=e.componentInstance.item;"action"===t.reason&&n&&(this.addTrigger(n),e.close())})),e.afterClosed().subscribe(()=>this.unsub("dialog_events"))}addTrigger(e){const t=Object(Ie.e)(this.item.triggers.concat(e.id));console.log("Triggers:",t,this.item.triggers),this.item.storePendingChange("triggers",t),this.item.save().then(()=>this._service.notifySuccess("Sucessfully added trigger"),e=>this._service.notifyError(`Error adding trigger. Error: ${e.message||e}`))}}return e.ngComponentDef=c.Rb({type:e,selectors:[["zone-triggers"]],factory:function(t){return new(t||e)(c.Xb(g.a),c.Xb(h.b))},inputs:{item:"item"},features:[c.Fb,c.Gb()],consts:13,vars:4,template:function(e,t){1&e&&(c.ec(0,"div",Te),c.ec(1,"div",ke),c.ec(2,"section",Se),c.ec(3,"div",ze),c.ec(4,"button",Re),c.kc("tapped",function(e){return t.selectTriggerToAdd()}),c.Tc(5,"Add trigger"),c.cc(),c.cc(),c.ec(6,"mat-form-field",Fe),c.ec(7,"div",Ee),c.Yb(8,"app-icon",$e),c.cc(),c.ec(9,"input",je),c.kc("ngModelChange",function(e){return t.search_str=e}),c.cc(),c.cc(),c.cc(),c.ec(10,"section",Ae),c.Rc(11,We,9,1,"table",De),c.Rc(12,Qe,3,0,"div",Xe),c.cc(),c.cc(),c.cc()),2&e&&(c.Ic(8),c.vc("icon",et),c.Ic(9),c.vc("ngModel",t.search_str),c.Ic(11),c.vc("ngIf",t.model.triggers&&t.model.triggers.length>0),c.Ic(12),c.vc("ngIf",!t.model.triggers||t.model.triggers.length<=0))},directives:[xe.b,u.b,b.b,b.e,Q.a,ee.a,s.b,s.k,s.n,i.n,i.m,o.f],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}.name[_ngcontent-%COMP%]{min-width:10em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin 250ms,height 250ms,width 250ms,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.description[_ngcontent-%COMP%]{font-size:.8em;padding:.5em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:50%}.select[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 .25em 1.5em}.select[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.25em}"]}),e})(),nt=[1,"container"],ct=[1,"sidebar"],it=["heading","Zones",3,"module","close","searchChange","event"],st=[3,"touchrelease"],ot=["name","zone",3,"item","active","tabs","event"],rt=["about",""],at=["systems",""],gt=["triggers",""],lt=[3,"item"];function dt(e,t){if(1&e&&c.Yb(0,"zone-about",lt),2&e){const e=c.pc();c.vc("item",e.item)}}function mt(e,t){if(1&e&&c.Yb(0,"zone-systems",lt),2&e){const e=c.pc();c.vc("item",e.item)}}function ht(e,t){if(1&e&&c.Yb(0,"zone-triggers",lt),2&e){const e=c.pc();c.vc("item",e.item)}}const ft={class:"backoffice-info-with-circle"},ut=function(e){return{id:"about",name:"About",template:e,icon:ft}},pt={class:"backoffice-documents"},vt=function(e,t){return{id:"systems",name:"Systems",template:e,count:t,icon:pt}},_t={class:"backoffice-stopwatch"},bt=function(e,t){return{id:"triggers",name:"Triggers",template:e,count:t,icon:_t}},yt=function(e,t,n){return[e,t,n]},Ct=(()=>{class e extends l.a{constructor(e,t,n,c){super(e,t,n),this._service=e,this._route=t,this._router=n,this._dialog=c,this.service=this._service.Zones}loadValues(){this._service.Systems.query({offset:0,limit:1,zone_id:this.item.id}).then(()=>this.system_count=this._service.Systems.last_total),this._service.SystemTriggers.query({offset:0,limit:1,zone_id:this.item.id}).then(()=>this.trigger_count=this._service.SystemTriggers.last_total)}new(){this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new a.r(this._service.Zones,{}),service:this._service.Zones}})}edit(){this.item&&this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Zones}})}delete(){if(this.item){const e=this._dialog.open(m.b,Object.assign({},m.a,{data:{title:"Delete zone",content:"<p>Are you sure you want delete this zone?</p><p>Deleting this zone will <strong>immediately</strong> remove systems without another zone</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(t=>{"done"===t.reason&&(e.componentInstance.loading="Deleting device...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted device "${this.item.name}".`),this._router.navigate(["/zones"]),e.close(),this.unsub("delete_confirm")},t=>{e.componentInstance.loading=null,this._service.notifyError(`Error deleting device. Error: ${t}`)}))}))}}}return e.ngComponentDef=c.Rb({type:e,selectors:[["app-zones"]],factory:function(t){return new(t||e)(c.Xb(g.a),c.Xb(o.a),c.Xb(o.c),c.Xb(h.b))},features:[c.Fb],consts:11,vars:18,template:function(e,t){if(1&e&&(c.ec(0,"div",nt),c.Pc(),c.ec(1,"div",ct),c.ec(2,"sidebar",it),c.kc("searchChange",function(e){return t.search(e)}),c.kc("event",function(e){return t.sidebarEvent(e)}),c.cc(),c.cc(),c.ec(3,"main",st),c.kc("touchrelease",function(e){return t.show_sidebar=!1}),c.ec(4,"item-display",ot),c.kc("event",function(e){return t.itemEvent(e)}),c.Rc(5,dt,1,1,"ng-template",null,rt,c.Sc),c.Rc(7,mt,1,1,"ng-template",null,at,c.Sc),c.Rc(9,ht,1,1,"ng-template",null,gt,c.Sc),c.cc(),c.cc(),c.cc()),2&e){const e=c.Bc(6),n=c.Bc(8),i=c.Bc(10);c.Mb("show",t.show_sidebar),c.Qc(),c.Ic(2),c.vc("module",t.module)("close",t.show_sidebar),c.Ic(4),c.vc("item",t.item)("active",t.tab)("tabs",c.yc(14,yt,c.wc(6,ut,e),c.xc(8,vt,n,t.system_count),c.xc(11,bt,i,t.trigger_count)))}},directives:[f.a,u.b,p.a,B,we,tt],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}"]}),e})(),Ot=[{path:"",component:Ct,children:[]},{path:":id",component:Ct,children:[]},{path:"**",redirectTo:""}];var Mt=n("PCNd");n.d(t,"AppZonesModule",function(){return wt});const wt=(()=>{class e{}return e.ngModuleDef=c.Vb({type:e}),e.ngInjectorDef=c.Ub({factory:function(t){return new(t||e)},imports:[[i.c,s.g,r.b,o.g.forChild(Ot),Mt.a]]}),e})();o.g.forChild(Ot)}}]);