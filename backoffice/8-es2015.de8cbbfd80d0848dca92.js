(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{aCzL:function(t,e,i){"use strict";i.r(e);var n=i("ofXK"),o=i("3Pt+"),s=i("tyNb"),c=i("THE0"),a=i("OaWH"),r=i("C/ya"),d=i("D/9M"),l=i("g+Po"),h=i("fXoL"),m=i("0IaG"),u=i("BAfr"),b=i("m6yr"),p=i("47y3");const f=function(){return{class:"backoffice-publish"}},g=function(t,e){return{id:"applications",name:"Applications",count:t,icon:e}},_=function(){return{class:"backoffice-lock-open"}},v=function(t,e){return{id:"authentication",name:"Authentication",count:t,icon:e}},w=function(){return{class:"backoffice-users"}},y=function(t,e){return{id:"users",name:"Users",count:t,icon:e}},O=function(t,e,i){return[t,e,i]};let C=(()=>{class t extends r.a{constructor(t,e,i,n){super(t,e,i),this._service=t,this._route=e,this._router=i,this._dialog=n,this.service=this._service.Domains}ngOnInit(){super.ngOnInit(),this._service.title="Domains"}loadValues(){let t={offset:0,limit:1,owner:this.item.id};this._service.Applications.query(t).then(t=>this.applications=this._service.Applications.last_total||t.length||0),t={offset:0,limit:1,authority_id:this.item.id},this._service.Users.query(t).then(t=>this.user_count=this._service.Users.last_total||t.length||0)}newItem(){this.modal_ref||(this.modal_ref=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new c.d(this._service.Domains,{}),service:this._service.Domains}}),this.subscription("modal_events",this.modal_ref.componentInstance.event.subscribe(t=>{"done"===t.reason&&this._router.navigate(["/domains",t.metadata.item.id])})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}editItem(){this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Domains}}),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}deleteItem(){this.item&&!this.modal_ref&&(this.modal_ref=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete domain",content:"<p>Are you sure you want delete this domain?</p><p>The domain will be deleted <strong>immediately.</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}})),this.subscription("delete_confirm",this.modal_ref.componentInstance.event.subscribe(t=>{"done"===t.reason&&(this.modal_ref.componentInstance.loading="Deleting domain...",this.item.delete().then(()=>{this._service.notifySuccess(`Successfully deleted domain "${this.item.name}".`),this._router.navigate(["/users"]),this._service.set("BACKOFFICE.removed",this.item.id),this.modal_ref.close()},t=>{this.modal_ref.componentInstance.loading=null,this._service.notifyError(`Error deleting domain. Error: ${t}`)}))})),this.modal_ref.afterClosed().subscribe(()=>{this.unsub("modal_events"),this.modal_ref=null}))}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(s.a),h.Rb(s.c),h.Rb(m.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["app-domains"]],features:[h.Ab],decls:5,vars:22,consts:[[1,"container"],[1,"sidebar"],["heading","Domains",3,"module","close","event"],[3,"touchrelease"],["name","domain","route","domains",3,"item","tabs","event"]],template:function(t,e){1&t&&(h.Xb(0,"div",0),h.Xb(1,"div",1),h.Xb(2,"sidebar",2),h.fc("event",(function(t){return e.sidebarEvent(t)})),h.Wb(),h.Wb(),h.Xb(3,"main",3),h.fc("touchrelease",(function(){return e.show_sidebar=!1})),h.Xb(4,"item-display",4),h.fc("event",(function(t){return e.itemEvent(t)})),h.Wb(),h.Wb(),h.Wb()),2&t&&(h.Hb("show",e.show_sidebar),h.Db(2),h.pc("module",e.module)("close",e.show_sidebar),h.Db(2),h.pc("item",e.item)("tabs",h.tc(18,O,h.sc(7,g,e.applications||0,h.qc(6,f)),h.sc(11,v,e.auth_sources||0,h.qc(10,_)),h.sc(15,y,e.user_count||0,h.qc(14,w)))))},directives:[u.a,b.b,p.a],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}}@media only screen and (orientation:portrait) and (max-width:450px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}@media only screen and (orientation:landscape) and (max-width:800px){.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}@media only screen and (orientation:landscape) and (max-width:800px){.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}@media only screen and (orientation:portrait) and (max-width:450px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}"]}),t})();var W=i("5f3J"),X=i("bTqV"),A=i("0njA");const P=function(){return{class:"backoffice-edit"}},x=function(){return{class:"backoffice-trash"}};function M(t,e){if(1&t){const t=h.Yb();h.Xb(0,"tr"),h.Xb(1,"td",7),h.Kc(2),h.Wb(),h.Xb(3,"td",8),h.Kc(4),h.Wb(),h.Xb(5,"td",9),h.Kc(6),h.Wb(),h.Xb(7,"td",10),h.Xb(8,"button",12),h.fc("tapped",(function(){h.Ac(t);const i=e.$implicit;return h.jc(3).editApplication(i)})),h.Sb(9,"app-icon",13),h.Wb(),h.Xb(10,"button",12),h.fc("tapped",(function(){h.Ac(t);const i=e.$implicit;return h.jc(3).deleteApplication(i)})),h.Sb(11,"app-icon",13),h.Wb(),h.Wb(),h.Wb()}if(2&t){const t=e.$implicit;h.Db(2),h.Lc(t.name),h.Db(2),h.Lc(t.redirect),h.Db(2),h.Lc(t.scope),h.Db(3),h.pc("icon",h.qc(5,P)),h.Db(2),h.pc("icon",h.qc(6,x))}}function I(t,e){if(1&t&&(h.Xb(0,"div",6),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",7),h.Kc(4,"Name"),h.Wb(),h.Xb(5,"td",8),h.Kc(6,"Redirect"),h.Wb(),h.Xb(7,"td",9),h.Kc(8,"Scope"),h.Wb(),h.Sb(9,"td",10),h.Wb(),h.Xb(10,"tbody"),h.Ic(11,M,12,7,"tr",11),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc(2);h.Db(11),h.pc("ngForOf",t.application_list)}}function D(t,e){1&t&&(h.Xb(0,"div",14),h.Xb(1,"div",15),h.Kc(2,"No applications found"),h.Wb(),h.Wb())}function k(t,e){if(1&t){const t=h.Yb();h.Xb(0,"div",1),h.Xb(1,"section",2),h.Xb(2,"button",3),h.fc("tapped",(function(){return h.Ac(t),h.jc().newApplication()})),h.Kc(3,"Add new"),h.Wb(),h.Wb(),h.Xb(4,"section"),h.Ic(5,I,12,1,"div",4),h.Ic(6,D,3,0,"div",5),h.Wb(),h.Wb()}if(2&t){const t=h.jc();h.Db(5),h.pc("ngIf",t.application_list&&t.application_list.length>0),h.Db(1),h.pc("ngIf",!t.application_list||t.application_list.length<=0)}}let S=(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadApplications()}))}ngOnChanges(t){t.item&&this.loadApplications()}loadApplications(t=0){this.item&&this._service.Applications.query({owner:this.item.id,offset:t}).then(e=>{t||(this.application_list=[]);for(const t of e||[]){let e=!1;for(const i of this.application_list)if(i.id===t.id){e=!0;break}e||this.application_list.push(t)}},()=>null)}newApplication(){this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new c.b(this._service.Applications,{}),service:this._service.Applications}})}editApplication(t){this.item&&this._dialog.open(d.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:t,service:this._service.Applications}})}deleteApplication(t){if(t){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete application",content:`<p>Are you sure you want delete the application ${t.name}?</p><p>Configuration will be <strong>immediately</strong> updated</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting application...",t.delete().then(()=>{this._service.notifySuccess(`Successfully deleted application "${t.name}".`),this.loadApplications(),e.close(),this.unsub("delete_confirm")},t=>{e.componentInstance.loading=null,this._service.notifyError(`Error deleting application. Error: ${t}`)}))}))}}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(m.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-applications"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:1,vars:1,consts:[["class","container",4,"ngIf"],[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"scope"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&h.Ic(0,k,7,2,"div",0),2&t&&h.pc("ngIf",e.item)},directives:[n.m,X.b,b.b,n.l,A.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.duo[_ngcontent-%COMP%]{width:6em}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]   .scope[_ngcontent-%COMP%]{width:8em;min-width:8em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})();var K=i("dQMc");const j=function(){return{class:"backoffice-edit"}},E=function(){return{class:"backoffice-trash"}};function L(t,e){if(1&t){const t=h.Yb();h.Xb(0,"tr"),h.Xb(1,"td",6),h.Kc(2),h.Wb(),h.Xb(3,"td",7),h.Kc(4),h.Wb(),h.Xb(5,"td",8),h.Xb(6,"button",10),h.fc("tapped",(function(){h.Ac(t);const i=e.$implicit;return h.jc(2).editAuthSource(i)})),h.Sb(7,"app-icon",11),h.Wb(),h.Xb(8,"button",10),h.fc("tapped",(function(){h.Ac(t);const i=e.$implicit;return h.jc(2).deleteAuthSource(i)})),h.Sb(9,"app-icon",11),h.Wb(),h.Wb(),h.Wb()}if(2&t){const t=e.$implicit,i=h.jc(2);h.Db(2),h.Lc(t.name),h.Db(2),h.Lc(i.source_types[t.id]),h.Db(3),h.pc("icon",h.qc(4,j)),h.Db(2),h.pc("icon",h.qc(5,E))}}function F(t,e){if(1&t&&(h.Xb(0,"div",5),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",6),h.Kc(4,"Name"),h.Wb(),h.Xb(5,"td",7),h.Kc(6,"Type"),h.Wb(),h.Sb(7,"td",8),h.Wb(),h.Xb(8,"tbody"),h.Ic(9,L,10,6,"tr",9),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc();h.Db(9),h.pc("ngForOf",t.auth_sources)}}function q(t,e){1&t&&(h.Xb(0,"div",12),h.Xb(1,"div",13),h.Kc(2,"No authentication sources found"),h.Wb(),h.Wb())}function $(t,e){if(1&t&&(h.Xb(0,"tr"),h.Xb(1,"td",4),h.Kc(2),h.Wb(),h.Xb(3,"td",5),h.Kc(4),h.Wb(),h.Xb(5,"td",6),h.Kc(6),h.Wb(),h.Wb()),2&t){const t=e.$implicit;h.Db(2),h.Lc(t.name),h.Db(2),h.Lc(t.email),h.Db(2),h.Lc(t.role)}}function R(t,e){if(1&t&&(h.Xb(0,"div",3),h.Xb(1,"table"),h.Xb(2,"thead"),h.Xb(3,"td",4),h.Kc(4,"Name"),h.Wb(),h.Xb(5,"td",5),h.Kc(6,"Email"),h.Wb(),h.Xb(7,"td",6),h.Kc(8,"Role"),h.Wb(),h.Wb(),h.Xb(9,"tbody"),h.Ic(10,$,7,3,"tr",7),h.Wb(),h.Wb(),h.Wb()),2&t){const t=h.jc();h.Db(10),h.pc("ngForOf",t.model.list)}}function B(t,e){1&t&&(h.Xb(0,"div",8),h.Xb(1,"div",9),h.Kc(2,"No users found"),h.Wb(),h.Wb())}const N=[{path:":id",component:C,children:[{path:"applications",component:S},{path:"authentication",component:(()=>{class t extends W.a{constructor(t,e){super(),this._service=t,this._dialog=e,this.auth_sources=[],this.source_types={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadAuthSources()}))}ngOnChanges(t){t.item&&this.loadAuthSources()}loadAuthSources(t=0){this.item&&Promise.all([this._service.OAuthSources.query({authority_id:this.item.id,offset:t}),this._service.SAMLAuthSources.query({authority_id:this.item.id,offset:t}),this._service.LDAPAuthSources.query({authority_id:this.item.id,offset:t})]).then(e=>{t||(this.auth_sources=[]);for(const t of e)t.forEach(t=>this.addAuthSourceToList(t))},()=>null)}newAuthSource(){this._dialog.open(K.a,{width:"auto",height:"auto",data:{domain:this.item}}).afterClosed().subscribe(()=>this.loadAuthSources())}editAuthSource(t){this._dialog.open(K.a,{width:"auto",height:"auto",data:{domain:this.item,auth_source:t}}).afterClosed().subscribe(()=>this.loadAuthSources())}deleteAuthSource(t){if(t){const e=this._dialog.open(l.b,Object.assign(Object.assign({},l.a),{data:{title:"Delete auth source",content:"<p>Are you sure you want delete this auth source?</p><p>Deleting this will remove this auth source <strong>immediately</strong></p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(i=>{"done"===i.reason&&(e.componentInstance.loading="Deleting auth source...",t.delete().then(()=>{this._service.notifySuccess("Successfully deleted auth source."),e.close(),this.unsub("delete_confirm"),this.loadAuthSources()},t=>{this._service.notifyError(`Error deleting auth source. Error ${t.message||t}`),e.componentInstance.loading=null}))}))}}addAuthSourceToList(t){this.source_types[t.id]=t instanceof c.l?"saml":t instanceof c.g?"ldap":"oauth";const e=this.auth_sources.findIndex(e=>e.id===t.id);e<0?this.auth_sources.push(t):this.auth_sources.splice(e,1,t)}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a),h.Rb(m.b))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-authentication"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:8,vars:2,consts:[[1,"container"],[1,"select"],["mat-button","",3,"tapped"],["class","list",4,"ngIf","ngIfElse"],["no_auth_sources",""],[1,"list"],[1,"name"],[1,"flex"],[1,"duo"],[4,"ngFor","ngForOf"],["mat-icon-button","",3,"tapped"],[3,"icon"],[1,"info-block"],[1,"text"]],template:function(t,e){if(1&t&&(h.Xb(0,"div",0),h.Xb(1,"section",1),h.Xb(2,"button",2),h.fc("tapped",(function(){return e.newAuthSource()})),h.Kc(3,"Add new"),h.Wb(),h.Wb(),h.Xb(4,"section"),h.Ic(5,F,10,1,"div",3),h.Wb(),h.Wb(),h.Ic(6,q,3,0,"ng-template",null,4,h.Jc)),2&t){const t=h.xc(7);h.Db(5),h.pc("ngIf",e.auth_sources&&e.auth_sources.length>0)("ngIfElse",t)}},directives:[X.b,b.b,n.m,n.l,A.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}.duo[_ngcontent-%COMP%]{width:6em;text-align:right}"]}),t})()},{path:"users",component:(()=>{class t extends W.a{constructor(t){super(),this._service=t,this.model={}}ngOnInit(){this.subscription("item",this._service.listen("BACKOFFICE.active_item",t=>{this.item=t,this.loadUsers()})),this.loadUsers()}ngOnChanges(t){t.item&&this.loadUsers()}loadUsers(t=0){this.item&&this._service.Users.query({authority_id:this.item.id,offset:t}).then(e=>{t||(this.model.list=[]);for(const t of e||[]){let e=!1;for(const i of this.model.list)if(i.id===t.id){e=!0;break}e||this.model.list.push(t)}},()=>null)}}return t.\u0275fac=function(e){return new(e||t)(h.Rb(a.a))},t.\u0275cmp=h.Lb({type:t,selectors:[["domain-users"]],inputs:{item:"item"},features:[h.Ab,h.Bb],decls:4,vars:2,consts:[[1,"container"],["class","list",4,"ngIf"],["class","info-block",4,"ngIf"],[1,"list"],[1,"name"],[1,"flex"],[1,"role"],[4,"ngFor","ngForOf"],[1,"info-block"],[1,"text"]],template:function(t,e){1&t&&(h.Xb(0,"div",0),h.Xb(1,"section"),h.Ic(2,R,11,1,"div",1),h.Ic(3,B,3,0,"div",2),h.Wb(),h.Wb()),2&t&&(h.Db(2),h.pc("ngIf",e.model.list&&e.model.list.length>0),h.Db(1),h.pc("ngIf",!e.model.list||e.model.list.length<=0))},directives:[n.m,n.l],styles:[".container[_ngcontent-%COMP%]{padding:1em}.options[_ngcontent-%COMP%]{display:flex;font-size:1.2em;max-width:5em;margin:0}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.table-row[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{width:12em;min-width:12em}.table-row[_ngcontent-%COMP%]   .role[_ngcontent-%COMP%]{width:8em;min-width:8em}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#d32f2f;border-radius:.8em;transition:margin .25s,height .25s,width .25s,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]{padding:.5em .25em}"]}),t})()},{path:"**",redirectTo:"applications"}]},{path:"**",redirectTo:"-"}];var T=i("PCNd");i.d(e,"AppDomainsModule",(function(){return U}));let U=(()=>{class t{}return t.\u0275mod=h.Pb({type:t}),t.\u0275inj=h.Ob({factory:function(e){return new(e||t)},imports:[[n.c,o.g,s.g.forChild(N),T.a]]}),t})()}}]);