(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{wKJ7:function(t,e,c){"use strict";c.r(e);var n=c("fXoL"),i=c("ofXK"),o=c("3Pt+"),s=c("tyNb"),r=c("CcG0"),a=c("mrSG"),d=c("UN3I"),g=c("OaWH"),m=c("C/ya"),l=c("0IXN"),h=c("g+Po"),p=c("D/9M"),f=c("LcAk"),u=c("BAfr"),v=c("m6yr"),b=c("47y3"),_=c("5f3J"),y=c("xQV9"),I=c("mrP1"),w=c("gVAx"),C=c("GrRB"),O=c("Xlwt"),M=c("0njA");const P=[1,"container"],T=[1,"settings"],k=[1,"field"],x=["for","dependency","matTooltip","System to use for available status variables and function calls"],R=[3,"service","ngModel","ngModelChange"],Y=[1,"action"],X=["mat-icon-button","",3,"disabled","tapped"],S=[3,"icon"],F=[1,"text"],$=["class","list",4,"ngIf"],A=["class","info-block",4,"ngIf"],E=[1,"list"],j=["class","item",4,"ngFor","ngForOf"],D=[1,"item"],N=[1,"handle"],V=[1,"details"],q=["mat-icon-button",""],z={class:"backoffice-select-arrows"},B={class:"backoffice-edit"},L={class:"backoffice-trash"};function G(t,e){if(1&t&&(n.ec(0,"div",D),n.ec(1,"div",N),n.Yb(2,"app-icon",S),n.cc(),n.ec(3,"div",V),n.Tc(4),n.qc(5,"json"),n.qc(6,"json"),n.cc(),n.ec(7,"button",q),n.Yb(8,"app-icon",S),n.cc(),n.ec(9,"button",q),n.Yb(10,"app-icon",S),n.cc(),n.cc()),2&t){const t=e.$implicit;n.Ic(2),n.vc("icon",z),n.Ic(4),n.Xc(" ",n.rc(5,6,t.left)," ",t.operator," ",n.rc(6,8,t.right)," "),n.Ic(8),n.vc("icon",B),n.Ic(10),n.vc("icon",L)}}function J(t,e){if(1&t&&(n.ec(0,"div",E),n.Rc(1,G,11,10,"div",j),n.cc()),2&t){const t=n.pc();n.Ic(1),n.vc("ngForOf",t.item.conditions.comparisons)}}function U(t,e){if(1&t&&(n.ec(0,"div",D),n.ec(1,"div",N),n.Yb(2,"app-icon",S),n.cc(),n.ec(3,"div",V),n.Tc(4),n.cc(),n.ec(5,"button",q),n.Yb(6,"app-icon",S),n.cc(),n.ec(7,"button",q),n.Yb(8,"app-icon",S),n.cc(),n.cc()),2&t){const t=e.$implicit;n.Ic(2),n.vc("icon",z),n.Ic(4),n.Vc(" ","at"===t.type?t.time:t.cron," "),n.Ic(6),n.vc("icon",B),n.Ic(8),n.vc("icon",L)}}function H(t,e){if(1&t&&(n.ec(0,"div",E),n.Rc(1,U,9,4,"div",j),n.cc()),2&t){const t=n.pc();n.Ic(1),n.vc("ngForOf",t.item.conditions.time_dependents)}}const Q=[1,"info-block"];function W(t,e){1&t&&(n.ec(0,"div",Q),n.ec(1,"div",F),n.Tc(2,"No conditions for trigger"),n.cc(),n.cc())}function K(t,e){if(1&t&&(n.ec(0,"div",D),n.ec(1,"div",N),n.Yb(2,"app-icon",S),n.cc(),n.ec(3,"div",V),n.Tc(4),n.cc(),n.ec(5,"button",q),n.Yb(6,"app-icon",S),n.cc(),n.ec(7,"button",q),n.Yb(8,"app-icon",S),n.cc(),n.cc()),2&t){const t=e.$implicit;n.Ic(2),n.vc("icon",z),n.Ic(4),n.Vc(" ",t.emails.join(", ")," "),n.Ic(6),n.vc("icon",B),n.Ic(8),n.vc("icon",L)}}function Z(t,e){if(1&t&&(n.ec(0,"div",E),n.Rc(1,K,9,4,"div",j),n.cc()),2&t){const t=n.pc();n.Ic(1),n.vc("ngForOf",t.item.actions.mailers)}}function tt(t,e){if(1&t&&(n.ec(0,"div",D),n.ec(1,"div",N),n.Yb(2,"app-icon",S),n.cc(),n.ec(3,"div",V),n.Tc(4),n.qc(5,"json"),n.cc(),n.ec(6,"button",q),n.Yb(7,"app-icon",S),n.cc(),n.ec(8,"button",q),n.Yb(9,"app-icon",S),n.cc(),n.cc()),2&t){const t=e.$implicit;n.Ic(2),n.vc("icon",z),n.Ic(4),n.Xc(" ",t.mod,", ",t.method,"(",n.rc(5,6,t.args),") "),n.Ic(7),n.vc("icon",B),n.Ic(9),n.vc("icon",L)}}function et(t,e){if(1&t&&(n.ec(0,"div",E),n.Rc(1,tt,10,8,"div",j),n.cc()),2&t){const t=n.pc();n.Ic(1),n.vc("ngForOf",t.item.actions.functions)}}function ct(t,e){1&t&&(n.ec(0,"div",Q),n.ec(1,"div",F),n.Tc(2,"No actions for trigger"),n.cc(),n.cc())}const nt={class:"backoffice-plus"},it=(()=>{class t extends _.a{constructor(t,e){super(),this._service=t,this._dialog=e}get system_service(){return this._service.Systems}addCondition(){this._dialog.open(I.a,{width:"auto",height:"auto",data:{trigger:this.item,system:this.template_system}})}addAction(){this._dialog.open(y.a,{data:{trigger:this.item,system:this.template_system}})}}return t.ngComponentDef=n.Rb({type:t,selectors:[["trigger-about"]],factory:function(e){return new(e||t)(n.Xb(g.a),n.Xb(f.b))},inputs:{item:"item"},features:[n.Fb],consts:27,vars:12,template:function(t,e){1&t&&(n.ec(0,"div",P),n.ec(1,"div",T),n.ec(2,"section"),n.ec(3,"div",k),n.ec(4,"label",x),n.Tc(5,"Template System: "),n.cc(),n.ec(6,"item-search-field",R),n.kc("ngModelChange",function(t){return e.template_system=t}),n.cc(),n.cc(),n.cc(),n.ec(7,"header"),n.ec(8,"div",Y),n.ec(9,"button",X),n.kc("tapped",function(t){return e.addCondition()}),n.Yb(10,"app-icon",S),n.cc(),n.cc(),n.ec(11,"div",F),n.Tc(12,"Conditions"),n.cc(),n.cc(),n.ec(13,"section"),n.Rc(14,J,2,1,"div",$),n.Rc(15,H,2,1,"div",$),n.Rc(16,W,3,0,"div",A),n.cc(),n.ec(17,"header"),n.ec(18,"div",Y),n.ec(19,"button",X),n.kc("tapped",function(t){return e.addAction()}),n.Yb(20,"app-icon",S),n.cc(),n.cc(),n.ec(21,"div",F),n.Tc(22,"Actions"),n.cc(),n.cc(),n.ec(23,"section"),n.Rc(24,Z,2,1,"div",$),n.Rc(25,et,2,1,"div",$),n.Rc(26,ct,3,0,"div",A),n.cc(),n.cc(),n.cc()),2&t&&(n.Ic(6),n.vc("service",e.system_service)("ngModel",e.template_system),n.Ic(9),n.vc("disabled",!e.template_system),n.Ic(10),n.vc("icon",nt),n.Ic(14),n.vc("ngIf",e.item.conditions&&e.item.conditions.comparisons),n.Ic(15),n.vc("ngIf",e.item.conditions&&e.item.conditions.time_dependents),n.Ic(16),n.vc("ngIf",!e.item.conditions||!e.item.conditions.comparisons&&!e.item.conditions.time_dependents||!e.item.conditions.comparisons.length&&e.item.conditions.time_dependents.length),n.Ic(19),n.vc("disabled",!e.template_system),n.Ic(20),n.vc("icon",nt),n.Ic(24),n.vc("ngIf",e.item.actions&&e.item.actions.mailers),n.Ic(25),n.vc("ngIf",e.item.actions&&e.item.actions.mailers),n.Ic(26),n.vc("ngIf",!e.item.actions||!e.item.actions.mailers&&!e.item.actions.functions||!e.item.actions.mailers.length&&!e.item.actions.functions.length))},directives:[w.a,C.a,o.k,o.n,O.b,v.b,M.a,i.n,i.m],pipes:[i.g],styles:[".container[_ngcontent-%COMP%]{padding:1em}header[_ngcontent-%COMP%]{display:flex;align-items:center;font-weight:700;font-size:1.1em}section[_ngcontent-%COMP%]{padding:.5em .25em}.no-item[_ngcontent-%COMP%]{font-size:.75em}button[_ngcontent-%COMP%]{margin-right:.5em;border:1px solid #000}button[disabled][_ngcontent-%COMP%]{border-color:#ccc}"]}),t})();var ot=c("oIn+");const st=[1,"container"],rt=[1,"settings"],at=[4,"ngIf","ngIfElse"],dt=["empty_state",""],gt=[1,"small"],mt=[1,"flex"],lt=[4,"ngFor","ngForOf"],ht=[1,"state"],pt=[3,"routerLink",4,"ngIf"],ft=["mat-icon-button","",3,"tapped"],ut=[3,"icon"],vt=[3,"routerLink"],bt=[1,"id"],_t=function(t){return["/systems",t]};function yt(t,e){if(1&t&&(n.ec(0,"a",vt),n.Tc(1),n.ec(2,"span",bt),n.Tc(3),n.cc(),n.Tc(4,") "),n.cc()),2&t){const t=n.pc().$implicit;n.vc("routerLink",n.wc(3,_t,t.system_id)),n.Ic(1),n.Vc(" ",t.system_name," ("),n.Ic(3),n.Uc(t.system_id)}}const It={class:"backoffice-trash"};function wt(t,e){if(1&t){const t=n.fc();n.ec(0,"tr"),n.ec(1,"td",gt),n.ec(2,"div",ht),n.Pc(),n.cc(),n.cc(),n.ec(3,"td",mt),n.Rc(4,yt,5,5,"a",pt),n.cc(),n.ec(5,"td"),n.Tc(6),n.qc(7,"dateFrom"),n.cc(),n.ec(8,"td",gt),n.ec(9,"button",ft),n.kc("tapped",function(c){n.Ec(t);const i=e.$implicit;return n.pc(2).delete(i)}),n.Yb(10,"app-icon",ut),n.cc(),n.cc(),n.cc()}if(2&t){const t=e.$implicit;n.Ic(2),n.Mb("active",t.enabled),n.Qc(),n.Ic(4),n.vc("ngIf",t.system_id),n.Ic(6),n.Uc(n.rc(7,4,1e3*(t.created_at-0))),n.Ic(10),n.vc("icon",It)}}function Ct(t,e){if(1&t&&(n.ec(0,"table"),n.ec(1,"thead"),n.Yb(2,"td",gt),n.ec(3,"td",mt),n.Tc(4,"Name"),n.cc(),n.ec(5,"td",mt),n.Tc(6,"Added"),n.cc(),n.Yb(7,"td",gt),n.cc(),n.ec(8,"tbody"),n.Rc(9,wt,11,6,"tr",lt),n.cc(),n.cc()),2&t){const t=n.pc();n.Ic(9),n.vc("ngForOf",t.system_trigger_list)}}const Ot=[1,"info-block"],Mt=[1,"text"];function Pt(t,e){1&t&&(n.ec(0,"div",Ot),n.ec(1,"div",Mt),n.Tc(2,"No systems with trigger"),n.cc(),n.cc())}const Tt=(()=>{class t extends _.a{constructor(t,e,c){super(),this._service=t,this._dialog=e,this._composer=c,this.system_trigger_list=[],this.connected={}}ngOnChanges(t){t.item&&this.loadSystemTriggers()}loadSystemTriggers(t=0){this._service.SystemTriggers.query({trigger_id:this.item.id,offset:t}).then(t=>this.system_trigger_list=t||[],()=>null)}delete(t){if(t){const e=this._dialog.open(h.b,Object.assign({},h.a,{data:{title:"Remove trigger",content:`<p>Are you sure you want remove this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove from the system "${t.system_name||""}"</p>`,icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",e.componentInstance.event.subscribe(c=>a.b(this,void 0,void 0,function*(){"done"===c.reason&&(e.componentInstance.loading="Removing trigger...",yield this.deleteTrigger(t).catch(t=>{throw e.componentInstance.loading=null,this._service.notifyError(`Error removing trigger. Error: ${t.message||t}`),t}),this.loadSystemTriggers(),e.close(),this.unsub("delete_confirm"))})))}}deleteTrigger(t){return new Promise((e,c)=>{this._composer.http.delete(`${this._composer.auth.api_endpoint}/systems/${t.system_id}/triggers/${t.id}`).subscribe(t=>null,t=>c(t),()=>e())})}}return t.ngComponentDef=n.Rb({type:t,selectors:[["trigger-systems"]],factory:function(e){return new(e||t)(n.Xb(g.a),n.Xb(f.b),n.Xb(r.c))},inputs:{item:"item"},features:[n.Fb,n.Gb()],consts:5,vars:2,template:function(t,e){if(1&t&&(n.ec(0,"div",st),n.ec(1,"div",rt),n.Rc(2,Ct,10,1,"table",at),n.cc(),n.cc(),n.Rc(3,Pt,3,0,"ng-template",null,dt,n.Sc)),2&t){const t=n.Bc(4);n.Ic(2),n.vc("ngIf",e.system_trigger_list.length>0)("ngIfElse",t)}},directives:[i.n,i.m,O.b,v.b,M.a,s.f],pipes:[ot.a],styles:[".container[_ngcontent-%COMP%]{padding:1em}.list[_ngcontent-%COMP%]{margin-top:.5em}tbody[_ngcontent-%COMP%]{font-size:.9em}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-overflow:ellipsis;white-space:nowrap}div[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{width:2em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]{width:4em}div[_ngcontent-%COMP%]   .duo[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{display:inline-flex}.action[_ngcontent-%COMP%]{height:1.5em;width:1.5em;min-width:1.5em;border-radius:.65em;display:flex;align-items:center;justify-content:center;font-size:1.3em}.action[_ngcontent-%COMP%]:hover{background-color:rgba(0,0,0,.1)}.state[_ngcontent-%COMP%]{height:1.5em;width:1.5em;margin:.25em;background-color:#000;border-radius:.8em;transition:margin 250ms,height 250ms,width 250ms,background-color .3s}.state.active[_ngcontent-%COMP%]{background-color:#4caf50;height:.75em;width:.75em;margin:.625em}.select[_ngcontent-%COMP%]{display:flex;align-items:center}.select[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{flex:1}"]}),t})(),kt=[1,"container"],xt=[1,"sidebar"],Rt=["heading","Triggers",3,"module","close","searchChange","event"],Yt=[3,"touchrelease"],Xt=["name","trigger",3,"item","loading","active","tabs","event"],St=["about",""],Ft=["systems",""],$t=[3,"item"];function At(t,e){if(1&t&&n.Yb(0,"trigger-about",$t),2&t){const t=n.pc();n.vc("item",t.item)}}function Et(t,e){if(1&t&&n.Yb(0,"trigger-systems",$t),2&t){const t=n.pc();n.vc("item",t.item)}}const jt={class:"backoffice-info-with-circle"},Dt=function(t){return{id:"about",name:"About",template:t,icon:jt}},Nt={class:"backoffice-documents"},Vt=function(t,e){return{id:"systems",name:"Systems",template:t,count:e,icon:Nt}},qt=function(t,e){return[t,e]},zt=(()=>{class t extends m.a{constructor(t,e,c,n){super(t,e,c),this._service=t,this._route=e,this._router=c,this._dialog=n,this.service=this._service.Triggers}loadValues(){const t={offset:0,limit:1,trigger_id:this.item.id};Object(l.b)(t),this._service.SystemTriggers.query(t).then(()=>this.system_count=this._service.SystemTriggers.last_total)}new(){this._dialog.open(p.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:new d.l(this._service.Triggers,{}),service:this._service.Triggers}})}edit(){this.item&&this._dialog.open(p.a,{height:"auto",width:"auto",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)",data:{item:this.item,service:this._service.Triggers}})}delete(){if(this.item){const t=this._dialog.open(h.b,Object.assign({},h.a,{data:{title:"Delete trigger",content:"<p>Are you sure you want delete this trigger?</p><p>Deleting this trigger will <strong>immediately</strong> remove it from all associated systems and zones</p>",icon:{type:"icon",class:"backoffice-trash"}}}));this.subscription("delete_confirm",t.componentInstance.event.subscribe(e=>a.b(this,void 0,void 0,function*(){"done"===e.reason&&(t.componentInstance.loading="Deleting trigger...",yield this.item.delete().catch(e=>{throw t.componentInstance.loading=null,this._service.notifyError(`Error deleting trigger. Error: ${e.message||e}`),e}),this._router.navigate(["/triggers"]),t.close(),this.unsub("delete_confirm"))})))}}}return t.ngComponentDef=n.Rb({type:t,selectors:[["app-triggers"]],factory:function(e){return new(e||t)(n.Xb(g.a),n.Xb(s.a),n.Xb(s.c),n.Xb(f.b))},features:[n.Fb],consts:9,vars:15,template:function(t,e){if(1&t&&(n.ec(0,"div",kt),n.Pc(),n.ec(1,"div",xt),n.ec(2,"sidebar",Rt),n.kc("searchChange",function(t){return e.search(t)}),n.kc("event",function(t){return e.sidebarEvent(t)}),n.cc(),n.cc(),n.ec(3,"main",Yt),n.kc("touchrelease",function(t){return e.show_sidebar=!1}),n.ec(4,"item-display",Xt),n.kc("event",function(t){return e.itemEvent(t)}),n.Rc(5,At,1,1,"ng-template",null,St,n.Sc),n.Rc(7,Et,1,1,"ng-template",null,Ft,n.Sc),n.cc(),n.cc(),n.cc()),2&t){const t=n.Bc(6),c=n.Bc(8);n.Mb("show",e.show_sidebar),n.Qc(),n.Ic(2),n.vc("module",e.module)("close",e.show_sidebar),n.Ic(4),n.vc("item",e.item)("loading",e.loading_item)("active",e.tab)("tabs",n.xc(12,qt,n.wc(7,Dt,t),n.xc(9,Vt,c,e.system_count)))}},directives:[u.a,v.b,b.a,it,Tt],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;width:100%}.sidebar[_ngcontent-%COMP%]{height:100%;width:20em}@media only screen and (orientation:portrait) and (max-width:450px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}@media only screen and (orientation:landscape) and (max-width:800px){.container[_ngcontent-%COMP%]{flex-direction:column}.container.show[_ngcontent-%COMP%]   .sidebar[_ngcontent-%COMP%]{height:100%}.container.show[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{height:0%}.sidebar[_ngcontent-%COMP%]{height:3em;min-height:3em;width:100%;transition:height .3s}main[_ngcontent-%COMP%]{transition:height .3s;width:100%}}main[_ngcontent-%COMP%]{position:relative;height:100%;overflow:hidden;flex:1;background-color:#f0f0f0}"]}),t})(),Bt=[{path:"",component:zt,children:[]},{path:":id",component:zt,children:[]},{path:"**",redirectTo:""}];var Lt=c("PCNd");c.d(e,"AppTriggersModule",function(){return Gt});const Gt=(()=>{class t{}return t.ngModuleDef=n.Vb({type:t}),t.ngInjectorDef=n.Ub({factory:function(e){return new(e||t)},imports:[[i.c,o.g,r.b,s.g.forChild(Bt),Lt.a]]}),t})();s.g.forChild(Bt)}}]);