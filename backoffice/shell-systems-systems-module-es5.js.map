{"version":3,"sources":["webpack:///src/app/shell/systems/system-about/system-about.template.html","webpack:///src/app/shell/systems/system-about/system-about.component.ts","webpack:///src/app/shell/systems/system-modules/system-modules.component.ts","webpack:///src/app/shell/systems/system-modules/system-modules.template.html","webpack:///src/app/shell/systems/system-triggers/system-triggers.component.ts","webpack:///src/app/shell/systems/system-triggers/system-triggers.template.html","webpack:///src/app/shell/systems/system-zones/system-zones.component.ts","webpack:///src/app/shell/systems/system-zones/system-zones.template.html","webpack:///src/app/shell/systems/systems.component.ts","webpack:///src/app/shell/systems/systems.template.html","webpack:///src/app/shell/systems/systems.module.ts","webpack:///src/app/shell/systems/systems.routes.ts"],"names":["SystemAboutComponent","_service","_dialog","other_settings","item","modules","subscription","listen","loadZones","loadSettings","changes","ref","open","data","title","content","icon","type","componentInstance","event","subscribe","e","reason","Systems","startSystem","id","then","result","err","notifyError","message","stopSystem","Zones","query","control_system_id","offset","list","sort","a","b","zones","indexOf","settings","get","selector","templateUrl","styleUrls","SystemModulesComponent","_debug_service","device_classes","device_listener","menu_options","name","offline_options","exclude_fn","role","Logic","loadModules","Modules","complete","devices","generateModuleBindings","device","power","viewState","reloadModule","remove","loadModule","hide_exec","running","stop","notifySuccess","length","viewDetails","start","show","k","hasOwnProperty","system","module","driver","reload","Drivers","driver_id","_","close","unsub","load","previousIndex","currentIndex","loading","storePendingChange","save","removeModule","splice","height","width","maxHeight","maxWidth","control_system","service","readonly","addModule","metadata","concat","version","_version","set","timeout","afterClosed","new_module","joinModule","mod_list","push","isListening","unbind","bind","counter","custom_name","reduce","map","SystemTriggersComponent","_composer","trigger_list","loadSystemTriggers","listTriggers","trigger","Triggers","external_save","url","auth","api_endpoint","http","put","toJSON","service_name","addTrigger","enabled","important","trigger_id","SystemZonesComponent","zone","listZones","emit","filter","new_zone","notifyInfo","SystemsComponent","_route","_router","limit","sys_id","trigger_count","device_count","zone_count","modal_ref","navigate","console","log","sidebarEvent","itemEvent","AppSystemsModule","forChild","declarations","imports","ROUTES","path","component","children","redirectTo"],"mappings":"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","file":"shell-systems-systems-module-es5.js","sourcesContent":["<div class=\"container\" *ngIf=\"item\">\n    <section class=\"select\">\n        <button mat-button (tapped)=\"start()\">Start System</button>\n        <button mat-button (tapped)=\"stop()\">Stop System</button>\n    </section>\n    <section class=\"details\">\n        <div class=\"field\" *ngIf=\"item.support_url\">\n            <label>Support URL:</label>\n            <div class=\"value\">\n                <a [href]=\"item.support_url\" target=\"_blank\">{{item.support_url}}</a>\n            </div>\n        </div>\n        <div class=\"field\" *ngIf=\"item.bookable\">\n            <label>Bookable Room:</label>\n            <div class=\"value\">{{item.bookable ? 'Yes' : 'No'}}</div>\n        </div>\n        <div class=\"field\" *ngIf=\"item.bookable && item.email\">\n            <label>Email:&nbsp;</label>\n            <a *ngIf=\"item.email\" [href]=\"'mailto:' + item.email\" target=\"_blank\">{{item.email}}</a>\n        </div>\n        <div class=\"field\" *ngIf=\"item.capacity\">\n            <label>Capacity:</label>\n            <div class=\"value\">{{item.capacity}}</div>\n        </div>\n        <div class=\"field\" *ngIf=\"item.installed_ui_devices\">\n            <label>Installed Touch Panels:</label>\n            <div class=\"value\">{{item.installed_ui_devices}}</div>\n        </div>\n    </section>\n    <hr />\n    <header class=\"settings\">Settings</header>\n    <section *ngIf=\"!loading_settings; else load_state\">\n        <a-settings-form [id]=\"item.id\" [merge]=\"true\" [settings]=\"item.settings\" [merge_settings]=\"other_settings || []\"></a-settings-form>\n    </section>\n</div>\n<ng-template #load_state>\n    <div class=\"info-block\">\n        <div class=\"icon\">\n            <mat-spinner diameter=\"48\"></mat-spinner>\n        </div>\n        <div class=\"text\">Loading system settings...</div>\n    </div>\n</ng-template>\n","import { Component, Input, OnChanges, SimpleChanges, OnInit } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { EngineSystem, EngineZone, EngineSettings, EncryptionLevel } from '@placeos/ts-client';\n\nimport { BaseDirective } from '../../../shared/globals/base.directive';\nimport { ApplicationService } from '../../../services/app.service';\nimport { DialogEvent, Identity } from 'src/app/shared/utilities/types.utilities';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA\n} from 'src/app/overlays/confirm-modal/confirm-modal.component';\n\n@Component({\n    selector: 'system-about',\n    templateUrl: './system-about.template.html',\n    styleUrls: ['./system-about.styles.scss']\n})\nexport class SystemAboutComponent extends BaseDirective implements OnChanges, OnInit {\n    /** System to render */\n    @Input() public item: EngineSystem;\n    /** List of zones for the active system */\n    public zones: EngineZone[];\n    /** List of settings for associated modules, drivers and zones */\n    public other_settings: EngineSettings[] = [];\n\n    /** List of module ids associated with the system */\n    public modules(): string[] {\n        return [...this.item.modules];\n    }\n\n    /** Whether application is loading settings for item */\n    public get loading_settings(): boolean {\n        return this._service.get('loading_settings');\n    }\n\n    constructor(private _service: ApplicationService, private _dialog: MatDialog) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'item',\n            this._service.listen('BACKOFFICE.active_item', item => {\n                this.item = item;\n                this.loadZones();\n                this.loadSettings();\n            })\n        );\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.item && this.item) {\n            this.loadZones();\n            this.loadSettings();\n        }\n    }\n\n    /**\n     * Open confirmation modal for starting the active system\n     */\n    public start() {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Start system?',\n                    content: `Are you sure you want to start this system?<br>All stopped modules within the system will boot up.`,\n                    icon: { type: 'icon', class: 'backoffice-controller-play' }\n                }\n            }\n        );\n        this.subscription(\n            'confirm_ref',\n            ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                if (e.reason === 'done') {\n                    this._service.Systems.startSystem(this.item.id).then(\n                        result => null,\n                        err =>\n                            this._service.notifyError(\n                                `Failed to start system: ${err.message || err}`\n                            )\n                    );\n                }\n            })\n        );\n    }\n\n    /**\n     * Open confirmation modal for stopping the active system\n     */\n    public stop() {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Stop system?',\n                    content: `Are you sure you want to stop this system?<br>All modules will be immediately stopped regardless of any other systems they may be in.`,\n                    icon: { type: 'icon', class: 'backoffice-controller-stop' }\n                }\n            }\n        );\n        this.subscription(\n            'confirm_ref',\n            ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                if (e.reason === 'done') {\n                    this._service.Systems.stopSystem(this.item.id).then(\n                        result => null,\n                        err =>\n                            this._service.notifyError(\n                                `Failed to stop system: ${err.message || err}`\n                            )\n                    );\n                }\n            })\n        );\n    }\n\n    /**\n     * Load zones associated with the system to allow for merging\n     */\n    public loadZones() {\n        if (!this.item) {\n            return;\n        }\n        this._service.Zones.query({ control_system_id: this.item.id, offset: 0 }).then(\n            list => {\n                list.sort((a, b) => this.item.zones.indexOf(b.id) - this.item.zones.indexOf(a.id));\n                this.zones = list;\n            },\n            () => null\n        );\n    }\n\n    public async loadSettings() {\n        if (!this.item) {\n            return;\n        }\n        this.other_settings = await this._service.Systems.settings(this.item.id);\n    }\n}\n","import { Component, Input, OnChanges, OnInit } from '@angular/core';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { MatDialog } from '@angular/material/dialog';\nimport { EngineSystem, EngineModule, EngineDriverRole, HashMap } from '@placeos/ts-client';\n\nimport { BaseDirective } from '../../../shared/globals/base.directive';\nimport { ApplicationService } from '../../../services/app.service';\nimport { ApplicationActionLink } from 'src/app/shared/utilities/settings.interfaces';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from 'src/app/overlays/confirm-modal/confirm-modal.component';\nimport { DialogEvent } from 'src/app/shared/utilities/types.utilities';\nimport {\n    ViewModuleStateModalComponent,\n    ModuleStateModalData,\n} from 'src/app/overlays/view-module-state/view-module-state.component';\nimport { EngineDebugService } from 'src/app/services/debug.service';\nimport { ItemCreateUpdateModalComponent } from 'src/app/overlays/item-modal/item-modal.component';\nimport { ViewResponseModalComponent } from 'src/app/overlays/view-response-modal/view-response-modal.component';\n\n@Component({\n    selector: 'system-modules',\n    templateUrl: './system-modules.template.html',\n    styleUrls: ['./system-modules.styles.scss'],\n})\nexport class SystemModulesComponent extends BaseDirective implements OnInit, OnChanges {\n    /** System to grab the devices for */\n    @Input() public item: EngineSystem;\n    /** List of modules associated with the system */\n    public devices: EngineModule[];\n    /** Mapping of devices to the module bindings */\n    public device_classes: HashMap<string> = {};\n    /** Whether a device should be listened to */\n    public device_listener: HashMap<boolean> = {};\n    /** Store for ID of new module to add to system */\n    public new_module: string;\n    /** Whether to show exec block */\n    public hide_exec: boolean;\n    /** Actions available for the context menu */\n    public menu_options: ApplicationActionLink[] = [\n        {\n            id: 'power',\n            name: 'Toggle Power',\n            icon: { type: 'icon', class: 'backoffice-power-plug' },\n        },\n        { id: 'state', name: 'View State', icon: { type: 'icon', class: 'backoffice-eye' } },\n        { id: 'reload', name: 'Reload Module', icon: { type: 'icon', class: 'backoffice-cw' } },\n        { id: 'remove', name: 'Remove Module', icon: { type: 'icon', class: 'backoffice-trash' } },\n        {\n            id: 'load',\n            name: 'Load Module',\n            icon: { type: 'icon', class: 'backoffice-arrow-with-circle-up' },\n        },\n    ];\n\n    public offline_options: ApplicationActionLink[] = [\n        {\n            id: 'power',\n            name: 'Toggle Power',\n            icon: { type: 'icon', class: 'backoffice-power-plug' },\n        },\n        { id: 'remove', name: 'Remove Module', icon: { type: 'icon', class: 'backoffice-trash' } },\n        {\n            id: 'load',\n            name: 'Load Module',\n            icon: { type: 'icon', class: 'backoffice-arrow-with-circle-up' },\n        },\n    ];\n    /** Function for excluding modules already within this system */\n    public readonly exclude_fn = (item: EngineModule) =>\n        item.control_system_id === this.item.id || item.role === EngineDriverRole.Logic;\n\n    /** Service for interacting with modules */\n    public get module_service() {\n        return this._service.Modules;\n    }\n\n    /** Map of modules to whether they are listening for debug messages */\n    public get debugged_modules(): HashMap<boolean> {\n        return this.devices.reduce((map, device) => {\n            map[device.id] = this._debug_service.isListening(device);\n            return map;\n        }, {});\n    }\n\n    constructor(\n        private _service: ApplicationService,\n        private _dialog: MatDialog,\n        private _debug_service: EngineDebugService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'item',\n            this._service.listen('BACKOFFICE.active_item', (item) => {\n                this.item = item;\n                this.loadModules();\n            })\n        );\n    }\n\n    public ngOnChanges(changes: any) {\n        if (changes.item) {\n            this.loadModules();\n        }\n    }\n\n    /**\n     * Load the modules for the active system\n     * @param offset Offset to load\n     */\n    public loadModules(offset: number = 0) {\n        if (!this.item) {\n            return;\n        }\n        this._service.Modules.query({\n            control_system_id: this.item.id,\n            complete: true,\n            offset,\n        } as any).then(\n            (list) => {\n                list.sort(\n                    (a, b) => this.item.modules.indexOf(a.id) - this.item.modules.indexOf(b.id)\n                );\n                this.devices = list;\n                this.generateModuleBindings();\n            },\n            () => null\n        );\n    }\n\n    /**\n     * Handle context menu event\n     * @param event Event posted by the context menu\n     * @param device Module associated with the context menu event\n     */\n    public handleContextEvent(event: ApplicationActionLink, device: EngineModule) {\n        if (event) {\n            switch (event.id) {\n                case 'power':\n                    this.power(device);\n                    break;\n                case 'state':\n                    this.viewState(device);\n                    break;\n                case 'reload':\n                    this.reloadModule(device);\n                    break;\n                case 'remove':\n                    this.remove(device);\n                    break;\n                case 'load':\n                    this.loadModule(device);\n                    break;\n            }\n        }\n    }\n\n    /**\n     * Toggle the power state\n     * @param device Module to toggle the power state\n     */\n    public power(device: EngineModule) {\n        this.hide_exec = true;\n        if (device.running) {\n            device.stop().then(\n                () => {\n                    this.hide_exec = false;\n                    this._service.notifySuccess('Module successfully stopped');\n                    (device as any).running = false;\n                },\n                (err) => {\n                    this.hide_exec = false;\n                    if (typeof err === 'string' && err.length < 64) {\n                        this._service.notifyError(err);\n                    } else {\n                        this._service.notifyError(\n                            `Failed to stop module '${device.id}'.\\nView Error?`,\n                            'View',\n                            () => this.viewDetails(err)\n                        );\n                    }\n                }\n            );\n        } else {\n            device.start().then(\n                () => {\n                    this.hide_exec = false;\n                    this._service.notifySuccess('Module successfully started');\n                    (device as any).running = true;\n                },\n                (err) => {\n                    this.hide_exec = false;\n                    if (typeof err === 'string' && err.length < 64) {\n                        this._service.notifyError(err);\n                    } else {\n                        this._service.notifyError(\n                            `Failed to start module '${device.id}'.\\nView Error?`,\n                            'View',\n                            () => this.viewDetails(err)\n                        );\n                    }\n                }\n            );\n        }\n    }\n\n    /**\n     * Update the state of the module\n     * @param device Module to reload\n     */\n    public reload(device: EngineModule) {\n        this._service.Modules.show(device.id).then(\n            (item) => {\n                for (const k in item) {\n                    if (item.hasOwnProperty(k)) {\n                        device[k] = item[k];\n                    }\n                }\n            },\n            () => null\n        );\n    }\n\n    public viewState(device: EngineModule) {\n        this._dialog.open<ViewModuleStateModalComponent, ModuleStateModalData>(\n            ViewModuleStateModalComponent,\n            { data: { system: this.item, module: device, devices: this.devices } }\n        );\n    }\n\n    public reloadModule(device: EngineModule) {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Reload module?',\n                    content: `New driver code will be loaded and the device settings will be reloaded.`,\n                    icon: { type: 'icon', class: 'backoffice-install' },\n                },\n            }\n        );\n        this.subscription(\n            'confirm_ref',\n            ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                if (e.reason === 'done') {\n                    (device.driver\n                        ? device.driver.reload()\n                        : this._service.Drivers.reload(device.driver_id)\n                    ).then(\n                        (_) => this._service.notifySuccess('Driver successfully reloaded.'),\n                        (err) => this._service.notifyError(err.message || err)\n                    );\n                    ref.close();\n                    this.unsub('confirm_ref');\n                }\n            })\n        );\n    }\n\n    public loadModule(device: EngineModule) {\n        this._service.Modules.load(device.id).then(\n            () =>\n                this._service.notifySuccess(\n                    `Successfully loaded module \"${device.name || device.id}\"`\n                ),\n            (err) => this._service.notifyError(`Error loading module. Error: ${err.message || err}`)\n        );\n    }\n\n    /** View Results of the execute */\n    private viewDetails(content: any) {\n        this._dialog.open<ViewResponseModalComponent>(ViewResponseModalComponent, {\n            data: { content },\n        });\n    }\n\n    /**\n     * Handle drop event for reordering the devices\n     * @param event Drag drop details\n     */\n    public drop(event: CdkDragDrop<any[]>) {\n        if (event && event.previousIndex !== event.currentIndex) {\n            const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                ConfirmModalComponent,\n                {\n                    ...CONFIRM_METADATA,\n                    data: {\n                        title: 'Change order?',\n                        content: `Are you sure you want to change the module priority?<br>Settings will be updated immediately for the system.`,\n                        icon: { type: 'icon', class: 'backoffice-layers' },\n                    },\n                }\n            );\n            this.subscription(\n                'confirm_ref',\n                ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                    if (e.reason === 'done') {\n                        this.hide_exec = true;\n                        ref.componentInstance.loading = 'Updating module order...';\n                        const list: string[] = [...this.item.modules];\n                        moveItemInArray(list, event.previousIndex, event.currentIndex);\n                        this.item.storePendingChange('modules', list);\n                        this.item.save().then(\n                            () => {\n                                this.hide_exec = false;\n                                ref.close();\n                                this.unsub('confirm_ref');\n                            },\n                            (err) => {\n                                this.hide_exec = false;\n                                ref.componentInstance.loading = null;\n                                this._service.notifyError(\n                                    `Error reording modules. Error: ${err.message || err}`\n                                );\n                            }\n                        );\n                    }\n                })\n            );\n        }\n    }\n\n    public remove(device: EngineModule) {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Remove module?',\n                    content: `Remove ${device.driver_id} from this system?<br>If this is not used elsewhere the associated data will be removed immediately.`,\n                    icon: { type: 'icon', class: 'backoffice-trash' },\n                },\n            }\n        );\n        this.subscription(\n            'confirm_ref',\n            ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                if (e.reason === 'done') {\n                    this.hide_exec = true;\n                    this.item.removeModule(device.id).then(\n                        () => {\n                            this.hide_exec = false;\n                            this._service.notifySuccess('Succefully removed module.');\n                            this.devices.splice(this.devices.indexOf(device), 1);\n                            ref.close();\n                            this.unsub('confirm_ref');\n                        },\n                        (err) => {\n                            this.hide_exec = false;\n                            this._service.notifyError(\n                                `Error removing module. Error: ${err.message || err}`\n                            );\n                            ref.close();\n                            this.unsub('confirm_ref');\n                        }\n                    );\n                }\n            })\n        );\n    }\n\n    public newModule() {\n        const ref = this._dialog.open(ItemCreateUpdateModalComponent, {\n            height: 'auto',\n            width: 'auto',\n            maxHeight: 'calc(100vh - 2em)',\n            maxWidth: 'calc(100vw - 2em)',\n            data: {\n                item: new EngineModule(this._service.Modules, {\n                    control_system_id: this.item.id,\n                    control_system: this.item,\n                }),\n                service: this._service.Modules,\n                readonly: true,\n            },\n        });\n        this.subscription(\n            'modal_events',\n            ref.componentInstance.event.subscribe((event) => {\n                if (event.reason === 'done') {\n                    this.hide_exec = true;\n                    this._service.Systems.addModule(this.item.id, event.metadata.item.id).then(\n                        () => {\n                            this.hide_exec = false;\n                            this.item = new EngineSystem(this._service.Systems, {\n                                ...this.item,\n                                modules: this.item.modules.concat(event.metadata.item.id),\n                                version: (this.item as any)._version++,\n                            });\n                            this._service.set('BACKOFFICE.active_item', this.item);\n                            this.timeout('reload_module_list', () => this.loadModules(), 1000);\n                        },\n                        (err) => {\n                            this.hide_exec = false;\n                        }\n                    );\n                }\n            })\n        );\n        ref.afterClosed().subscribe(() => {\n            this.unsub('modal_events');\n        });\n    }\n\n    public addModule() {\n        if (this.new_module) {\n            this.joinModule(this.new_module);\n            this.new_module = '';\n        }\n    }\n\n    public joinModule(id: string) {\n        const mod_list = [...this.item.modules];\n        if (mod_list.indexOf(id) < 0) {\n            mod_list.push(id);\n        }\n        this.hide_exec = true;\n        this.item.storePendingChange('modules', mod_list);\n        this._service.Systems.addModule(this.item.id, id).then(\n            () => {\n                this.hide_exec = false;\n                this.item = new EngineSystem(this._service.Systems, {\n                    ...this.item,\n                    modules: this.item.modules.concat(id),\n                    version: (this.item as any)._version++,\n                });\n                this._service.notifySuccess('Successfully added device to system');\n                this.loadModules();\n            },\n            () => {\n                this.hide_exec = false;\n                this._service.notifyError('Failed to add module to system');\n            }\n        );\n    }\n\n    /**\n     * Toggle debug events for a device\n     * @param device Module to listen to debug events for\n     */\n    public toggleDebugEvents(device: EngineModule) {\n        if (!device) {\n            return;\n        }\n        if (this._debug_service.isListening(device)) {\n            this._debug_service.unbind(device);\n        } else {\n            this._debug_service.bind(device, this.device_classes[device.id]);\n        }\n    }\n\n    /**\n     * Generate the binding modules for each device\n     */\n    private generateModuleBindings() {\n        const counter: HashMap<number> = {};\n        for (const device of this.devices) {\n            const name = device.custom_name || device.name || 'Blank';\n            if (!counter[name]) {\n                counter[name] = 0;\n            }\n            this.device_classes[device.id] = `${name}_${++counter[name]}`;\n        }\n    }\n}\n","<div class=\"container\" *ngIf=\"item\">\n    <section class=\"select\">\n        <div class=\"dropdown\">\n            <item-search-field\n                [service]=\"module_service\"\n                [exclude]=\"exclude_fn\"\n                [ngModel]=\"null\"\n                (ngModelChange)=\"new_module = $event.id\"\n            ></item-search-field>\n        </div>\n        <button mat-button [disabled]=\"!new_module\" (tapped)=\"addModule()\">\n            Add existing\n        </button>\n        <button mat-button (tapped)=\"newModule()\">Add new</button>\n    </section>\n    <ng-container *ngIf=\"item.id && item.modules && !hide_exec\">\n        <section class=\"exec\">\n            <h3>Execute command</h3>\n            <system-exec-field [system]=\"item\"></system-exec-field>\n        </section>\n    </ng-container>\n    <section class=\"device-list\">\n        <h3>Module List</h3>\n        <table *ngIf=\"devices && devices.length > 0\">\n            <thead>\n                <td class=\"small\"></td>\n                <td class=\"small\">State</td>\n                <td class=\"name\">Name</td>\n                <td class=\"module\">Class</td>\n                <td class=\"ip\">IP</td>\n                <td class=\"small\"></td>\n            </thead>\n            <tbody cdkDropList (cdkDropListDropped)=\"drop($event)\">\n                <tr\n                    *ngFor=\"let device of (devices || [])\"\n                    [context-menu]=\"menu\"\n                    [offset_y]=\"-64\"\n                    (contextAction)=\"handleContextEvent($event, device)\"\n                    cdkDrag\n                >\n                    <td class=\"small\">\n                        <div class=\"action grab\" cdkDragHandle>\n                            <i class=\"backoffice-select-arrows\"></i>\n                        </div>\n                    </td>\n                    <td class=\"small\">\n                        <i\n                            *ngIf=\"device && item.id\"\n                            binding\n                            [(model)]=\"device.connected\"\n                            [sys]=\"item.id\"\n                            [mod]=\"device_classes[device.id]\"\n                            bind=\"connected\"\n                        ></i>\n                        <div\n                            class=\"state\"\n                            [class.active]=\"device.running && device.connected\"\n                            [class.inactive]=\"device.running && !device.connected\"\n                            (tapped)=\"power(device)\"\n                        ></div>\n                    </td>\n                    <td class=\"name\">\n                        <a\n                            [routerLink]=\"['/modules', device.id]\"\n                            routerLinkActive=\"router-link-active\" [matTooltip]=\"device.id\"\n                            >{{device.driver?.name || \"&lt;Unnamed&gt;\" }}</a\n                        >\n                    </td>\n                    <td class=\"module\">\n                        <mat-checkbox\n                            [checked]=\"debugged_modules[device.id]\"\n                            (change)=\"toggleDebugEvents(device)\"\n                        >\n                            {{ device_classes[device.id] }}\n                        </mat-checkbox>\n                    </td>\n                    <td class=\"ip\">\n                        <div class=\"lock\">\n                            <i class=\"backoffice-lock\" *ngIf=\"device.tls\"></i>\n                        </div>\n                        <a [href]=\"(device.tls ? 'https://' : 'http://') + device.ip\"\n                            >{{device.ip}}</a\n                        >\n                    </td>\n                    <td class=\"small\" touchrelease>\n                        <button mat-icon-button [matMenuTriggerFor]=\"menu\">\n                            <app-icon\n                                [icon]=\"{ class: 'backoffice-dots-three-vertical' }\"\n                            ></app-icon>\n                        </button>\n                        <mat-menu #menu=\"matMenu\">\n                            <button\n                                mat-menu-item\n                                *ngFor=\"let item of (device.running ? menu_options : offline_options)\"\n                                (tapped)=\"handleContextEvent(item, device)\"\n                            >\n                                <app-icon [icon]=\"item.icon\"></app-icon>\n                                <div class=\"text\">{{ item.name }}</div>\n                            </button>\n                        </mat-menu>\n                    </td>\n                    <td class=\"placeholder\" colspan=\"6\" *cdkDragPlaceholder></td>\n                </tr>\n            </tbody>\n        </table>\n        <div class=\"info-block\" *ngIf=\"!devices || devices.length <= 0\">\n            <div class=\"text\">No devices for system</div>\n        </div>\n    </section>\n</div>\n","import { Component, Input, OnChanges, OnInit } from '@angular/core';\nimport { EngineSystem, EngineTrigger } from '@placeos/ts-client';\n\nimport { BaseDirective } from '../../../shared/globals/base.directive';\nimport { ApplicationService } from '../../../services/app.service';\nimport { MatDialog } from '@angular/material/dialog';\nimport {\n    SelectItemModalComponent,\n    SelectItemModalData\n} from 'src/app/overlays/select-item-modal/select-item-modal.component';\nimport { DialogEvent } from 'src/app/shared/utilities/types.utilities';\nimport {\n    CONFIRM_METADATA,\n    ConfirmModalComponent,\n    ConfirmModalData\n} from 'src/app/overlays/confirm-modal/confirm-modal.component';\nimport { ComposerService } from '@placeos/composer';\nimport { ItemCreateUpdateModalComponent } from 'src/app/overlays/item-modal/item-modal.component';\n\n@Component({\n    selector: 'system-triggers',\n    templateUrl: './system-triggers.template.html',\n    styleUrls: ['./system-triggers.styles.scss']\n})\nexport class SystemTriggersComponent extends BaseDirective implements OnChanges, OnInit {\n    /** Active System */\n    @Input() public item: EngineSystem;\n    /** List of triggers associated with the active system */\n    public trigger_list: EngineTrigger[] = [];\n    /** Filter string for listing of triggers */\n    public search_str: string;\n\n    constructor(\n        private _service: ApplicationService,\n        private _dialog: MatDialog,\n        private _composer: ComposerService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'item',\n            this._service.listen('BACKOFFICE.active_item', item => {\n                this.item = item;\n                this.loadSystemTriggers();\n            })\n        );\n    }\n\n    public ngOnChanges(changes: any): void {\n        if (changes.item) {\n            this.loadSystemTriggers();\n        }\n    }\n\n    public loadSystemTriggers(offset: number = 0): void {\n        if (!this.item) { return; }\n        this._service.Systems.listTriggers(this.item.id).then(\n            list => {\n                this.trigger_list = list;\n            },\n            () => null\n        );\n    }\n\n    /**\n     * Open the modal to create a new system\n     */\n    public editTrigger(trigger: EngineTrigger) {\n        if (this.item && trigger) {\n            const ref = this._dialog.open(ItemCreateUpdateModalComponent, {\n                height: 'auto',\n                width: 'auto',\n                maxHeight: 'calc(100vh - 2em)',\n                maxWidth: 'calc(100vw - 2em)',\n                data: {\n                    item: trigger,\n                    service: this._service.Triggers,\n                    external_save: true\n                }\n            });\n            this.subscription(\n                'delete_confirm',\n                ref.componentInstance.event.subscribe((event: DialogEvent) => {\n                    if (event.reason === 'action') {\n                        ref.componentInstance.loading = 'Saving trigger settings...';\n                        const url = `${this._composer.auth.api_endpoint}/systems/${this.item.id}/triggers/${trigger.id}`;\n                        this._composer.http.put(url, trigger.toJSON(true)).subscribe(\n                            () => null,\n                            err => {\n                                ref.componentInstance.loading = null;\n                                this._service.notifyError(`Error updating trigger settings. Error: ${err.message || err}`);\n                            },\n                            () => {\n                                this._service.notifySuccess(\n                                    `Successfully updated trigger settings.`\n                                );\n                                ref.close();\n                                this.unsub('delete_confirm');\n                            }\n                        );\n                    }\n                })\n            );\n        }\n    }\n\n    /**\n     * Remove a trigger from the active system\n     * @param trigger Trigger to remove\n     */\n    public deleteTrigger(trigger: EngineTrigger) {\n        if (this.item && trigger) {\n            const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                ConfirmModalComponent,\n                {\n                    ...CONFIRM_METADATA,\n                    data: {\n                        title: `Remove trigger`,\n                        content: `<p>Are you sure you want remove trigger \"${trigger.name}\"?</p><p>Configuration will be updated <strong>immediately</strong>.</p>`,\n                        icon: { type: 'icon', class: 'backoffice-trash' }\n                    }\n                }\n            );\n            this.subscription(\n                'delete_confirm',\n                ref.componentInstance.event.subscribe((event: DialogEvent) => {\n                    if (event.reason === 'done') {\n                        ref.componentInstance.loading = 'Removing trigger...';\n                        const url = `${this._composer.auth.api_endpoint}/systems/${this.item.id}/triggers/${trigger.id}`;\n                        this._composer.http.delete(url).subscribe(\n                            () => null,\n                            err => {\n                                ref.componentInstance.loading = null;\n                                this._service.notifyError(`Error removing trigger. Error: ${err.message || err}`);\n                            },\n                            () => {\n                                this._service.notifySuccess(\n                                    `Successfully deleted trigger \"${this.item.name}\".`\n                                );\n                                ref.close();\n                                this.unsub('delete_confirm');\n                            }\n                        );\n                    }\n                })\n            );\n        }\n    }\n\n    /**\n     * Open modal to select a trigger to add\n     */\n    public selectTriggerToAdd(): void {\n        const ref = this._dialog.open<SelectItemModalComponent, SelectItemModalData>(\n            SelectItemModalComponent,\n            {\n                height: 'auto',\n                width: 'auto',\n                data: {\n                    service_name: 'Triggers'\n                }\n            }\n        );\n        this.subscription(\n            'dialog_events',\n            ref.componentInstance.event.subscribe((event: DialogEvent) => {\n                const item = ref.componentInstance.item;\n                if (event.reason === 'action' && item) {\n                    this.addTrigger(item);\n                    ref.close();\n                }\n            })\n        );\n        ref.afterClosed().subscribe(() => this.unsub('dialog_events'));\n    }\n\n    /**\n     * Add the selected trigger to the active system\n     * @param trigger Trigger to add to system\n     */\n    private addTrigger(trigger: EngineTrigger): void {\n        this._service.Systems.addTrigger(this.item.id, {\n            control_system_id: this.item.id,\n            enabled: true,\n            important: false,\n            trigger_id: trigger.id\n        });\n    }\n}\n","<div class=\"container\" *ngIf=\"item\">\n    <div class=\"settings\">\n        <section class=\"select\">\n            <div class=\"dropdown\">\n                <button mat-button (tapped)=\"selectTriggerToAdd()\">Add trigger</button>\n            </div>\n            <mat-form-field appearance=\"outline\">\n                <div class=\"prefix\" matPrefix>\n                    <app-icon [icon]=\"{ class: 'backoffice-magnifying-glass' }\"></app-icon>\n                </div>\n                <input\n                    matInput\n                    [(ngModel)]=\"search_str\"\n                    name=\"search-filter\"\n                    placeholder=\"Filter Triggers\"\n                />\n            </mat-form-field>\n        </section>\n        <section class=\"list\">\n            <table *ngIf=\"trigger_list.length > 0; else empty_state\">\n                <thead>\n                    <td class=\"small\"></td>\n                    <td class=\"flex\">Name</td>\n                    <td class=\"count\">Count</td>\n                    <td class=\"added\">Added</td>\n                    <td class=\"duo\"></td>\n                </thead>\n                <tbody>\n                    <tr *ngFor=\"let trigger of trigger_list\">\n                        <td class=\"small\">\n                            <div class=\"state\" [class.active]=\"trigger.enabled\"></div>\n                        </td>\n                        <td class=\"flex\">\n                            <a [routerLink]=\"['/triggers', trigger.id]\" [matTooltip]=\"trigger.id\">{{trigger.name}}</a>\n                        </td>\n                        <td class=\"count\">{{ trigger.activated_count || '0' }}</td>\n                        <td class=\"added\">{{ (+trigger.created_at * 1000) | dateFrom }}</td>\n                        <td class=\"duo\">\n                            <div class=\"actions\">\n                                <button mat-icon-button (tapped)=\"editTrigger(trigger)\">\n                                    <app-icon [icon]=\"{ class: 'backoffice-edit' }\"></app-icon>\n                                </button>\n                                <button mat-icon-button (tapped)=\"deleteTrigger(trigger)\">\n                                    <app-icon [icon]=\"{ class: 'backoffice-trash' }\"></app-icon>\n                                </button>\n                            </div>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </section>\n    </div>\n</div>\n<ng-template #empty_state>\n    <div class=\"info-block\">\n        <div class=\"text\">No triggers for system</div>\n    </div>\n</ng-template>\n","import { Component, Input, OnChanges, OnInit, Output, EventEmitter } from '@angular/core';\nimport { moveItemInArray } from '@angular/cdk/drag-drop';\nimport { MatDialog } from '@angular/material/dialog';\nimport { EngineSystem, EngineZone, EngineZonesService } from '@placeos/ts-client';\n\nimport { BaseDirective } from '../../../shared/globals/base.directive';\nimport { ApplicationService } from '../../../services/app.service';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA\n} from 'src/app/overlays/confirm-modal/confirm-modal.component';\nimport { DialogEvent } from 'src/app/shared/utilities/types.utilities';\nimport { unique } from 'src/app/shared/utilities/general.utilities';\n\n@Component({\n    selector: 'system-zones',\n    templateUrl: './system-zones.template.html',\n    styleUrls: ['./system-zones.styles.scss']\n})\nexport class SystemZonesComponent extends BaseDirective implements OnChanges, OnInit {\n    /** Active item */\n    @Input() public item: EngineSystem;\n    /** Emitter for changes to the loading state of the item */\n    @Output() public loading = new EventEmitter<boolean | string>();\n    /** List of zones assoicated with the active item */\n    public zones: EngineZone[];\n    /** ID of a zone that the user wishes to add to the system */\n    public new_zone: EngineZone;\n\n    public readonly exclude_fn = (zone: EngineZone) => this.item.zones.indexOf(zone.id) >= 0\n\n    /** Service for managing zone data */\n    public get zone_service(): EngineZonesService {\n        return this._service.Zones;\n    }\n\n    constructor(private _service: ApplicationService, private _dialog: MatDialog) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'item',\n            this._service.listen('BACKOFFICE.active_item', item => {\n                this.item = item;\n                this.loadZones();\n            })\n        );\n    }\n\n    public ngOnChanges(changes: any) {\n        if (changes.item) {\n            this.loadZones();\n        }\n    }\n\n    /**\n     * Load zone data for the active item\n     * @param offset Page offset for the service request\n     */\n    public loadZones(offset: number = 0) {\n        if (!this.item) { return; }\n        this._service.Systems.listZones(this.item.id).then(\n            list => {\n                list.sort((a, b) => this.item.zones.indexOf(a.id) - this.item.zones.indexOf(b.id));\n                this.zones = list;\n            },\n            () => null\n        );\n    }\n\n    public drop(event) {\n        if (event && event.previousIndex !== event.currentIndex) {\n            const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                ConfirmModalComponent,\n                {\n                    ...CONFIRM_METADATA,\n                    data: {\n                        title: 'Change order?',\n                        content: `Are you sure you want to change the zone priority?<br>Settings will be updated immediately for the system.`,\n                        icon: { type: 'icon', class: 'backoffice-cycle' }\n                    }\n                }\n            );\n            this.subscription(\n                'confirm_ref',\n                ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                    if (e.reason === 'done') {\n                        const list: string[] = [...this.item.zones];\n                        moveItemInArray(list, event.previousIndex, event.currentIndex);\n                        ref.componentInstance.loading = 'Updating zone ordering...';\n                        this.item.storePendingChange('zones', list);\n                        this.item.save().then(\n                            () => {\n                                ref.close();\n                                this.unsub('confirm_ref');\n                            },\n                            err => {\n                                ref.componentInstance.loading = null;\n                                this._service.notifyError(\n                                    `Error reording zones. Error: ${err.message || err}`\n                                );\n                            }\n                        );\n                    }\n                })\n            );\n        }\n    }\n\n    public removeZone(zone: EngineZone) {\n        if (zone && zone.id) {\n            const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                ConfirmModalComponent,\n                {\n                    ...CONFIRM_METADATA,\n                    data: {\n                        title: 'Remove zone?',\n                        content: `<p>Are you sure you want remove zone \"${zone.name}\" from the system?</p>Configuration will be updated immediately.`,\n                        icon: { type: 'icon', class: 'backoffice-trash' }\n                    }\n                }\n            );\n            this.subscription(\n                'confirm_ref',\n                ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                    if (e.reason === 'done') {\n                        this.loading.emit(true);\n                        this.item.storePendingChange('zones', this.item.zones.filter(id => id !== zone.id));\n                        this.item.save().then(\n                            (item: any) => {\n                                this.loading.emit(false);\n                                this.item = item;\n                                this._service.notifySuccess(\n                                    `Remove zone \"${zone.name}\" from system`\n                                );\n                                ref.close();\n                                this.unsub('confirm_ref');\n                            },\n                            err => {\n                                this.loading.emit(false);\n                                this._service.notifySuccess(\n                                    `Error removing \"${zone.name}\" from system. Error: ${err}`\n                                );\n                                ref.close();\n                                this.unsub('confirm_ref');\n                            }\n                        );\n                    }\n                })\n            );\n        }\n    }\n\n    public joinZone() {\n        if (this.new_zone) {\n            if (this.item.zones.indexOf(this.new_zone.id) < 0) {\n                this.loading.emit(true);\n                const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                    ConfirmModalComponent,\n                    {\n                        ...CONFIRM_METADATA,\n                        data: {\n                            title: 'Add zone',\n                            content: `Add zone \"${this.new_zone.name}\" to system \"${this.item.name}\"`,\n                            icon: { type: 'icon', class: 'backoffice-upload-to-cloud' }\n                        }\n                    }\n                );\n                this.subscription(\n                    'confirm_ref',\n                    ref.componentInstance.event.subscribe((e: DialogEvent) => {\n                        if (e.reason === 'done') {\n                            ref.componentInstance.loading = 'Adding zone to system...';\n                            this.item.storePendingChange('zones', unique([...this.item.zones, this.new_zone.id]));\n                            this.item.save().then(\n                                (item: any) => {\n                                    this.loading.emit(false);\n                                    this._service.notifySuccess(\n                                        `Added zone \"${this.new_zone.name}\" to system`\n                                    );\n                                    this.item = item;\n                                    this.loadZones();\n                                    ref.close();\n                                    this.unsub('confirm_ref');\n                                    this.new_zone = null;\n                                },\n                                (err) => {\n                                    ref.componentInstance.loading = null;\n                                    this.loading.emit(false);\n                                    this._service.notifyError(\n                                        `Error adding zone \"${this.new_zone.name}\". Error: ${err.message || err}`\n                                    );\n                                }\n                            );\n                        } else {\n                            this.loading.emit(false);\n                        }\n                    })\n                );\n            } else {\n                this._service.notifyInfo('The selected zone is already linked to this system');\n            }\n        }\n    }\n}\n","<div class=\"container\" *ngIf=\"item\">\n    <div class=\"settings\">\n        <section class=\"select\">\n            <div class=\"dropdown\">\n                <item-search-field\n                    [service]=\"zone_service\"\n                    [exclude]=\"exclude_fn\"\n                    [ngModel]=\"null\"\n                    (ngModelChange)=\"new_zone = $event\"\n                ></item-search-field>\n            </div>\n            <button mat-button [disabled]=\"!new_zone\" (tapped)=\"joinZone()\">Join zone</button>\n        </section>\n        <section>\n            <table *ngIf=\"zones && zones.length > 0\">\n                <thead>\n                    <td class=\"small\"></td>\n                    <td class=\"name\">Name</td>\n                    <td class=\"description\">Description</td>\n                    <td *ngIf=\"zones.length > 1\" class=\"small\"></td>\n                </thead>\n                <tbody cdkDropList (cdkDropListDropped)=\"drop($event)\">\n                    <tr *ngFor=\"let zone of zones\" cdkDrag>\n                        <td class=\"small\">\n                            <div class=\"action grab\" cdkDragHandle>\n                                <i class=\"backoffice-select-arrows\"></i>\n                            </div>\n                        </td>\n                        <td class=\"name\">\n                            <a\n                                [routerLink]=\"['/zones', zone.id]\"\n                                routerLinkActive=\"router-link-active\"\n                                [matTooltip]=\"zone.id\"\n                                >{{zone.name}}</a\n                            >\n                        </td>\n                        <td class=\"description\">{{zone.description}}</td>\n                        <td *ngIf=\"zones.length > 1\" class=\"small\">\n                            <button mat-icon-button (tapped)=\"removeZone(zone)\">\n                                <i class=\"backoffice-trash\"></i>\n                            </button>\n                        </td>\n                        <td class=\"placeholder\" colspan=\"6\" *cdkDragPlaceholder></td>\n                    </tr>\n                </tbody>\n            </table>\n            <div class=\"info-block\" *ngIf=\"!zones || zones.length <= 0\">\n                <div class=\"text\">No zones for system</div>\n            </div>\n        </section>\n    </div>\n</div>\n","import { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { EngineSystem } from '@placeos/ts-client';\n\nimport { ApplicationService } from '../../services/app.service';\nimport { BaseRootComponent } from '../../shared/components/base-root.component';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ItemCreateUpdateModalComponent } from 'src/app/overlays/item-modal/item-modal.component';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA\n} from 'src/app/overlays/confirm-modal/confirm-modal.component';\nimport { DialogEvent } from 'src/app/shared/utilities/types.utilities';\n\n@Component({\n    selector: 'app-systems',\n    templateUrl: './systems.template.html',\n    styleUrls: ['./systems.styles.scss']\n})\nexport class SystemsComponent extends BaseRootComponent<EngineSystem> {\n    /** Number of triggers for the active system */\n    public trigger_count: number;\n    /** Number of devices for the active system */\n    public device_count: number;\n    /** Number of zones for the active system */\n    public zone_count: number;\n\n    constructor(\n        protected _service: ApplicationService,\n        protected _route: ActivatedRoute,\n        protected _router: Router,\n        private _dialog: MatDialog\n    ) {\n        super(_service, _route, _router);\n        this.service = this._service.Systems;\n    }\n\n    public ngOnInit(): void {\n        super.ngOnInit();\n        this._service.title = 'Systems';\n    }\n\n    protected loadValues() {\n        const query: any = { offset: 0, limit: 1, sys_id: this.item.id };\n        // Get trigger count\n        this._service.Systems.listTriggers(this.item.id).then(\n            list =>\n                (this.trigger_count = list.length || 0)\n        );\n        // Get device count\n        this.device_count = (this.item.modules || []).length;\n        // Get zone count\n        this.zone_count = (this.item.zones || []).length;\n    }\n\n    /**\n     * Open the modal to create a new system\n     */\n    protected newItem() {\n        if (this.modal_ref) { return }\n        this.modal_ref = this._dialog.open(ItemCreateUpdateModalComponent, {\n            height: 'auto',\n            width: 'auto',\n            maxHeight: 'calc(100vh - 2em)',\n            maxWidth: 'calc(100vw - 2em)',\n            data: {\n                item: new EngineSystem(this._service.Systems, {}),\n                service: this._service.Systems\n            }\n        });\n        this.subscription('modal_events', this.modal_ref.componentInstance.event.subscribe(event => {\n            if (event.reason === 'done') {\n                this._router.navigate(['/systems', event.metadata.item.id]);\n            }\n        }));\n        this.modal_ref.afterClosed().subscribe(() => {\n            this.unsub('modal_events');\n            this.modal_ref = null;\n        });\n    }\n\n    /**\n     * Open the modal to create a new system\n     */\n    protected editItem() {\n        console.log('Edit');\n        if (this.item && !this.modal_ref) {\n            this.modal_ref = this._dialog.open(ItemCreateUpdateModalComponent, {\n                height: 'auto',\n                width: 'auto',\n                maxHeight: 'calc(100vh - 2em)',\n                maxWidth: 'calc(100vw - 2em)',\n                data: {\n                    item: this.item,\n                    service: this._service.Systems\n                }\n            });\n            this.modal_ref.afterClosed().subscribe(() => {\n                this.unsub('modal_events');\n                this.modal_ref = null;\n            });\n        }\n    }\n\n    protected deleteItem() {\n        if (this.item && !this.modal_ref) {\n            this.modal_ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n                ConfirmModalComponent,\n                {\n                    ...CONFIRM_METADATA,\n                    data: {\n                        title: `Delete system`,\n                        content: `<p>Are you sure you want delete this system?</p><p>Deleting this will <strong>immediately</strong> delete modules that are not in another system</p>`,\n                        icon: { type: 'icon', class: 'backoffice-trash' }\n                    }\n                }\n            );\n            this.subscription(\n                'modal_events',\n                this.modal_ref.componentInstance.event.subscribe((event: DialogEvent) => {\n                    if (event.reason === 'done') {\n                        this.modal_ref.componentInstance.loading = 'Deleting system...';\n                        this.item.delete().then(\n                            () => {\n                                this._service.notifySuccess(\n                                    `Successfully deleted system \"${this.item.name}\".`\n                                );\n                                this._service.set('BACKOFFICE.removed', this.item.id);\n                                this._router.navigate(['/systems']);\n                                this.modal_ref.close();\n                            },\n                            err => {\n                                this.modal_ref.componentInstance.loading = null;\n                                this._service.notifyError(`Error deleting system. Error: ${err}`);\n                            }\n                        );\n                    }\n                })\n            );\n            this.modal_ref.afterClosed().subscribe(() => {\n                this.unsub('modal_events');\n                this.modal_ref = null;\n            });\n        }\n    }\n}\n","<div class=\"container\" [class.show]=\"show_sidebar\">\n    <div class=\"sidebar\">\n        <sidebar\n            heading=\"Systems\"\n            [module]=\"module\"\n            [close]=\"show_sidebar\"\n            (event)=\"sidebarEvent($event)\"\n        ></sidebar>\n    </div>\n    <main (touchrelease)=\"show_sidebar = false\">\n        <item-display\n            name=\"system\"\n            route=\"systems\"\n            [item]=\"item\"\n            [loading]=\"loading_item\"\n            [tabs]=\"[\n                { id: 'about', name: 'About', icon: { class: 'backoffice-info-with-circle' } },\n                {\n                    id: 'modules',\n                    name: 'Modules',\n                    count: device_count,\n                    icon: { class: 'backoffice-tablet' }\n                },\n                { id: 'zones', name: 'Zones', count: zone_count, icon: { class: 'backoffice-layers' } },\n                {\n                    id: 'triggers',\n                    name: 'Triggers',\n                    count: trigger_count,\n                    icon: { class: 'backoffice-stopwatch' }\n                }\n            ]\"\n            (event)=\"itemEvent($event)\"\n        >\n        </item-display>\n    </main>\n</div>\n","\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\n\nimport { ROUTES } from './systems.routes';\n\nimport { SystemsComponent } from './systems.component';\nimport { SystemAboutComponent } from './system-about/system-about.component';\nimport { SystemModulesComponent } from './system-modules/system-modules.component';\nimport { SystemTriggersComponent } from './system-triggers/system-triggers.component';\nimport { SystemZonesComponent } from './system-zones/system-zones.component';\nimport { SharedContentModule } from 'src/app/shared/shared.module';\n\n@NgModule({\n    declarations: [\n        SystemsComponent,\n        SystemAboutComponent,\n        SystemModulesComponent,\n        SystemTriggersComponent,\n        SystemZonesComponent,\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        RouterModule.forChild(ROUTES),\n        SharedContentModule,\n        DragDropModule\n    ]\n})\nexport class AppSystemsModule { }\n","import { Routes } from '@angular/router';\nimport { SystemsComponent } from './systems.component';\nimport { SystemAboutComponent } from './system-about/system-about.component';\nimport { SystemModulesComponent } from './system-modules/system-modules.component';\nimport { SystemTriggersComponent } from './system-triggers/system-triggers.component';\nimport { SystemZonesComponent } from './system-zones/system-zones.component';\n\nexport const ROUTES: Routes = [\n    {\n        path: ':id',\n        component: SystemsComponent,\n        children: [\n            { path: 'about', component: SystemAboutComponent },\n            { path: 'modules', component: SystemModulesComponent },\n            { path: 'triggers', component: SystemTriggersComponent },\n            { path: 'zones', component: SystemZonesComponent },\n            { path: '**', redirectTo: 'about' }\n        ]\n    },\n    { path: '**', redirectTo: '-' }\n];\n"]}